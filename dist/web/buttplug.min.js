!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["buttplug-commonjs"]=t():e.Buttplug=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=91)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(28);r(83);class i{constructor(e){this.Id=e}DowngradeMessage(){return new u("Message version downgrade required, but not defined for this message type.",o.ERROR_MSG,this.Id)}get Type(){return this.constructor.name}getType(){return this.Type}toJSON(){return JSON.stringify(this.toProtocolFormat())}toProtocolFormat(){const e={};return e[this.Type]=n.classToPlain(this),e}}t.ButtplugMessage=i;class a extends i{constructor(e,t){super(t),this.DeviceIndex=e,this.Id=t}}t.ButtplugDeviceMessage=a;class s extends i{constructor(e=0){super(e),this.Id=e}}var o,c;t.ButtplugSystemMessage=s,t.Ok=class extends s{constructor(e){super(e),this.Id=e}get SchemaVersion(){return 0}},t.Ping=class extends i{constructor(e){super(e),this.Id=e}get SchemaVersion(){return 0}},t.Test=class extends i{constructor(e,t=1){super(t),this.TestString=e,this.Id=t}get SchemaVersion(){return 0}},(c=o=t.ErrorClass||(t.ErrorClass={}))[c.ERROR_UNKNOWN=0]="ERROR_UNKNOWN",c[c.ERROR_INIT=1]="ERROR_INIT",c[c.ERROR_PING=2]="ERROR_PING",c[c.ERROR_MSG=3]="ERROR_MSG",c[c.ERROR_DEVICE=4]="ERROR_DEVICE";class u extends s{constructor(e,t=o.ERROR_UNKNOWN,r=1){super(r),this.ErrorMessage=e,this.ErrorCode=t,this.Id=r}get SchemaVersion(){return 0}}t.Error=u;class l{constructor(e,t,r){this.DeviceIndex=e,this.DeviceName=t,this.DeviceMessages=r}}t.DeviceInfo=l;class h extends s{constructor(e,t){super(),this.Devices=e,this.Id=t}get Type(){return"DeviceList"}get SchemaVersion(){return 0}}t.DeviceListVersion0=h,t.DeviceInfoWithSpecifications=class{constructor(e,t,r){this.DeviceIndex=e,this.DeviceName=t,this.DeviceMessages=r}};class d extends s{constructor(e,t){super(),this.Devices=e,this.Id=t}get Type(){return"DeviceList"}DowngradeMessage(){const e=[];for(const t of this.Devices)e.push(new l(t.DeviceIndex,t.DeviceName,Object.keys(t.DeviceMessages)));return new h(e,this.Id)}get SchemaVersion(){return 1}}t.DeviceListVersion1=d,t.DeviceList=d;class f extends s{constructor(e,t,r){super(),this.DeviceIndex=e,this.DeviceName=t,this.DeviceMessages=r}get Type(){return"DeviceAdded"}get SchemaVersion(){return 0}}t.DeviceAddedVersion0=f;class p extends s{constructor(e,t,r){super(),this.DeviceIndex=e,this.DeviceName=t,this.DeviceMessages=r}get Type(){return"DeviceAdded"}get SchemaVersion(){return 1}DowngradeMessage(){return new f(this.DeviceIndex,this.DeviceName,Object.keys(this.DeviceMessages))}}t.DeviceAddedVersion1=p,t.DeviceAdded=p,t.DeviceRemoved=class extends s{constructor(e){super(),this.DeviceIndex=e}get SchemaVersion(){return 0}},t.RequestDeviceList=class extends i{constructor(e=1){super(e),this.Id=e}get SchemaVersion(){return 0}},t.StartScanning=class extends i{constructor(e=1){super(e),this.Id=e}get SchemaVersion(){return 0}},t.StopScanning=class extends i{constructor(e=1){super(e),this.Id=e}get SchemaVersion(){return 0}},t.ScanningFinished=class extends s{constructor(){super()}get SchemaVersion(){return 0}},t.RequestLog=class extends i{constructor(e,t=1){super(t),this.LogLevel=e,this.Id=t}get SchemaVersion(){return 0}},t.Log=class extends s{constructor(e,t){super(),this.LogLevel=e,this.LogMessage=t}get SchemaVersion(){return 0}},t.RequestServerInfo=class extends i{constructor(e,t=0,r=1){super(r),this.ClientName=e,this.MessageVersion=t,this.Id=r}get SchemaVersion(){return 1}},t.ServerInfo=class extends s{constructor(e,t,r,n,i,a,s=1){super(),this.MajorVersion=e,this.MinorVersion=t,this.BuildVersion=r,this.MessageVersion=n,this.MaxPingTime=i,this.ServerName=a,this.Id=s}get SchemaVersion(){return 0}},t.FleshlightLaunchFW12Cmd=class extends a{constructor(e,t,r=-1,n=1){super(r,n),this.Speed=e,this.Position=t,this.DeviceIndex=r,this.Id=n}get SchemaVersion(){return 0}},t.KiirooCmd=class extends a{constructor(e="0",t=-1,r=1){super(t,r),this.Command=e,this.DeviceIndex=t,this.Id=r}SetPosition(e){this.Command=e>=0&&e<=4?String(Math.round(e)):"0"}GetPosition(){const e=Number(this.Command)?Number(this.Command):0;return e<0||e>4?0:Math.round(e)}get SchemaVersion(){return 0}},t.SingleMotorVibrateCmd=class extends a{constructor(e,t=-1,r=1){super(t,r),this.Speed=e,this.DeviceIndex=t,this.Id=r}get SchemaVersion(){return 0}},t.StopDeviceCmd=class extends a{constructor(e=-1,t=1){super(e,t),this.DeviceIndex=e,this.Id=t}get SchemaVersion(){return 0}},t.StopAllDevices=class extends i{constructor(e=1){super(e),this.Id=e}get SchemaVersion(){return 0}},t.LovenseCmd=class extends a{constructor(e,t=-1,r=1){super(t,r),this.Command=e,this.DeviceIndex=t,this.Id=r}get SchemaVersion(){return 0}},t.VorzeA10CycloneCmd=class extends a{constructor(e,t,r=-1,n=1){super(r,n),this.Speed=e,this.Clockwise=t,this.DeviceIndex=r,this.Id=n}get SchemaVersion(){return 0}},t.SpeedSubcommand=class{constructor(e,t){this.Index=e,this.Speed=t}},t.VibrateCmd=class extends a{constructor(e,t=-1,r=1){super(t,r),this.Speeds=e,this.DeviceIndex=t,this.Id=r}get SchemaVersion(){return 1}},t.RotateSubcommand=class{constructor(e,t,r){this.Index=e,this.Speed=t,this.Clockwise=r}},t.RotateCmd=class extends a{constructor(e,t=-1,r=1){super(t,r),this.Rotations=e,this.DeviceIndex=t,this.Id=r}get SchemaVersion(){return 1}},t.VectorSubcommand=class{constructor(e,t,r){this.Index=e,this.Position=t,this.Duration=r}},t.LinearCmd=class extends a{constructor(e,t=-1,r=1){super(t,r),this.Vectors=e,this.DeviceIndex=t,this.Id=r}get SchemaVersion(){return 1}},t.MessageAttributes=class{constructor(e){this.FeatureCount=e}}},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,s,o,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(a(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(i(r))for(o=Array.prototype.slice.call(arguments,1),s=(u=r.slice()).length,c=0;c<s;c++)u[c].apply(this,o);return!0},r.prototype.addListener=function(e,t){var s;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(s=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var r,a,s,o;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,a=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(o=s;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){a=o;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){(function(e,n){var i;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(a){"object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType;var s="object"==typeof n&&n;s.global!==s&&s.window!==s&&s.self;var o,c=2147483647,u=36,l=1,h=26,d=38,f=700,p=72,m=128,v="-",g=/^xn--/,y=/[^\x20-\x7E]/,P=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=u-l,w=Math.floor,E=String.fromCharCode;function b(e){throw new RangeError(_[e])}function x(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function I(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+x((e=e.replace(P,".")).split("."),t).join(".")}function C(e){for(var t,r,n=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function D(e){return x(e,function(e){var t="";return e>65535&&(t+=E((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+E(e)}).join("")}function L(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function M(e,t,r){var n=0;for(e=r?w(e/f):e>>1,e+=w(e/t);e>S*h>>1;n+=u)e=w(e/S);return w(n+(S+1)*e/(e+d))}function R(e){var t,r,n,i,a,s,o,d,f,g,y,P=[],_=e.length,S=0,E=m,x=p;for((r=e.lastIndexOf(v))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&b("not-basic"),P.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<_;){for(a=S,s=1,o=u;i>=_&&b("invalid-input"),((d=(y=e.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:u)>=u||d>w((c-S)/s))&&b("overflow"),S+=d*s,!(d<(f=o<=x?l:o>=x+h?h:o-x));o+=u)s>w(c/(g=u-f))&&b("overflow"),s*=g;x=M(S-a,t=P.length+1,0==a),w(S/t)>c-E&&b("overflow"),E+=w(S/t),S%=t,P.splice(S++,0,E)}return D(P)}function O(e){var t,r,n,i,a,s,o,d,f,g,y,P,_,S,x,I=[];for(P=(e=C(e)).length,t=m,r=0,a=p,s=0;s<P;++s)(y=e[s])<128&&I.push(E(y));for(n=i=I.length,i&&I.push(v);n<P;){for(o=c,s=0;s<P;++s)(y=e[s])>=t&&y<o&&(o=y);for(o-t>w((c-r)/(_=n+1))&&b("overflow"),r+=(o-t)*_,t=o,s=0;s<P;++s)if((y=e[s])<t&&++r>c&&b("overflow"),y==t){for(d=r,f=u;!(d<(g=f<=a?l:f>=a+h?h:f-a));f+=u)x=d-g,S=u-g,I.push(E(L(g+x%S,0))),d=w(x/S);I.push(E(L(d,0))),a=M(r,_,n==i),r=0,++n}++r,++t}return I.join("")}o={version:"1.4.1",ucs2:{decode:C,encode:D},decode:R,encode:O,toASCII:function(e){return I(e,function(e){return y.test(e)?"xn--"+O(e):e})},toUnicode:function(e){return I(e,function(e){return g.test(e)?R(e.slice(4).toLowerCase()):e})}},void 0===(i=function(){return o}.call(t,r,t,e))||(e.exports=i)}()}).call(this,r(78)(e),r(11))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(14);t.ButtplugBluetoothDevice=class extends n.ButtplugDevice{constructor(e,t){super(e,t.Id),this._deviceImpl=t}Disconnect(){this._deviceImpl.Disconnect()}OnDisconnect(){this.emit("deviceremoved",this)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BluetoothDeviceInfo=class{constructor(e,t,r,n){this._names=e,this._services=t,this._characteristics=r,this._createFunc=n}get Names(){return this._names}get Services(){return this._services}get Characteristics(){return this._characteristics}get Create(){return this._createFunc}}},function(e,t,r){"use strict";function n(e,t,r){var n=r?" !== ":" === ",i=r?" || ":" && ",a=r?"!":"",s=r?"":"!";switch(e){case"null":return t+n+"null";case"array":return a+"Array.isArray("+t+")";case"object":return"("+a+t+i+"typeof "+t+n+'"object"'+i+s+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+n+'"number"'+i+s+"("+t+" % 1)"+i+t+n+t+")";default:return"typeof "+t+n+'"'+e+'"'}}e.exports={copy:function(e,t){t=t||{};for(var r in e)t[r]=e[r];return t},checkDataType:n,checkDataTypes:function(e,t){switch(e.length){case 1:return n(e[0],t,!0);default:var r="",i=a(e);i.array&&i.object&&(r=i.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete i.null,delete i.array,delete i.object),i.number&&delete i.integer;for(var s in i)r+=(r?" && ":"")+n(s,t,!0);return r}},coerceToTypes:function(e,t){if(Array.isArray(t)){for(var r=[],n=0;n<t.length;n++){var a=t[n];i[a]?r[r.length]=a:"array"===e&&"array"===a&&(r[r.length]=a)}if(r.length)return r}else{if(i[t])return[t];if("array"===e&&"array"===t)return["array"]}},toHash:a,getProperty:c,escapeQuotes:u,equal:r(9),ucs2length:r(77),varOccurences:function(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0},varReplace:function(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")},cleanUpCode:function(e){return e.replace(l,"").replace(h,"").replace(d,"if (!($1))")},finalCleanUpCode:function(e,t){var r=e.match(f);return r&&2==r.length&&(e=t?e.replace(m,"").replace(y,P):e.replace(p,"").replace(v,g)),(r=e.match(_))&&3===r.length?e.replace(S,""):e},schemaHasRules:function(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0},schemaHasRulesExcept:function(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var n in e)if(n!=r&&t[n])return!0},toQuotedString:w,getPathExpr:function(e,t,r,n){return x(e,r?"'/' + "+t+(n?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):n?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")},getPath:function(e,t,r){return x(e,w(r?"/"+I(t):c(t)))},getData:function(e,t,r){var n,i,a,s;if(""===e)return"rootData";if("/"==e[0]){if(!E.test(e))throw new Error("Invalid JSON-pointer: "+e);i=e,a="rootData"}else{if(!(s=e.match(b)))throw new Error("Invalid JSON-pointer: "+e);if(n=+s[1],"#"==(i=s[2])){if(n>=t)throw new Error("Cannot access property/index "+n+" levels up, current level is "+t);return r[t-n]}if(n>t)throw new Error("Cannot access data "+n+" levels up, current level is "+t);if(a="data"+(t-n||""),!i)return a}for(var o=a,u=i.split("/"),l=0;l<u.length;l++){var h=u[l];h&&(o+=" && "+(a+=c(C(h))))}return o},unescapeFragment:function(e){return C(decodeURIComponent(e))},unescapeJsonPointer:C,escapeFragment:function(e){return encodeURIComponent(I(e))},escapeJsonPointer:I};var i=a(["string","number","integer","boolean","null"]);function a(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}var s=/^[a-z$_][a-z$_0-9]*$/i,o=/'|\\/g;function c(e){return"number"==typeof e?"["+e+"]":s.test(e)?"."+e:"['"+u(e)+"']"}function u(e){return e.replace(o,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}var l=/else\s*{\s*}/g,h=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,d=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g,f=/[^v.]errors/g,p=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,m=/var errors = 0;|var vErrors = null;/g,v="return errors === 0;",g="validate.errors = null; return true;",y=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,P="return data;",_=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,S=/if \(rootData === undefined\) rootData = data;/;function w(e){return"'"+u(e)+"'"}var E=/^\/(?:[^~]|~0|~1)*$/,b=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function x(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function I(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function C(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(0);var a,s;(s=a=t.ButtplugLogLevel||(t.ButtplugLogLevel={}))[s.Off=0]="Off",s[s.Fatal=1]="Fatal",s[s.Error=2]="Error",s[s.Warn=3]="Warn",s[s.Info=4]="Info",s[s.Debug=5]="Debug",s[s.Trace=6]="Trace";class o{constructor(e,t){const r=new Date,n=r.getHours(),i=r.getMinutes(),a=r.getSeconds();this.timestamp=`${n}:${i}:${a}`,this.logMessage=e,this.logLevel=t}get Message(){return this.logMessage}get LogLevel(){return this.logLevel}get Timestamp(){return this.timestamp}get FormattedMessage(){return`${a[this.logLevel]} : ${this.timestamp} : ${this.logMessage}`}}t.LogMessage=o;class c extends n.EventEmitter{constructor(){super(),this.maximumConsoleLogLevel=a.Off,this.maximumEventLogLevel=a.Off}static get Logger(){return void 0===c.sLogger&&(c.sLogger=new c),this.sLogger}get MaximumConsoleLogLevel(){return this.maximumConsoleLogLevel}set MaximumConsoleLogLevel(e){this.maximumConsoleLogLevel=e}get MaximumEventLogLevel(){return this.maximumEventLogLevel}set MaximumEventLogLevel(e){this.maximumEventLogLevel=e}LogAndError(e,t,r){return this.Error(e),new i.Error(e,t,r)}Fatal(e){this.AddLogMessage(e,a.Fatal)}Error(e){this.AddLogMessage(e,a.Error)}Warn(e){this.AddLogMessage(e,a.Warn)}Info(e){this.AddLogMessage(e,a.Info)}Debug(e){this.AddLogMessage(e,a.Debug)}Trace(e){this.AddLogMessage(e,a.Trace)}AddLogMessage(e,t){if(t>this.maximumEventLogLevel&&t>this.maximumConsoleLogLevel)return;const r=new o(e,t);t<=this.maximumConsoleLogLevel&&console.log(r.FormattedMessage),t<=this.maximumEventLogLevel&&this.emit("log",r)}}c.sLogger=void 0,t.ButtplugLogger=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(28),i=r(80),a=r(0),s=r(46),o=new i;o.addMetaSchema(r(45));const c=o.compile(s);t.CheckMessage=function(e){if(c([e.toProtocolFormat()]))return;const t=c.errors.map(e=>e.message).join("; ");throw new Error(t)},t.FromJSON=function(e){const t=JSON.parse(e);if(!c(t)){const e=c.errors.map(e=>e.message).join("; ");return[new a.Error(e,a.ErrorClass.ERROR_MSG,0)]}const r=[];for(const e of Array.from(t)){const t=n.plainToClass(a[Object.getOwnPropertyNames(e)[0]],e[Object.getOwnPropertyNames(e)[0]]);r.push(t)}return r},t.GetSchemaVersion=function(){return parseInt(s.version,10)},t.CreateSimpleVibrateCmd=function(e,t){if(-1===e.AllowedMessages.indexOf("VibrateCmd"))throw new Error("Device does not handle VibrateCmd!");const r=[];for(let n=0;n<e.MessageAttributes("VibrateCmd").FeatureCount;++n)r.push(new a.SpeedSubcommand(n,t));return new a.VibrateCmd(r)},t.CreateSimpleLinearCmd=function(e,t,r){if(-1===e.AllowedMessages.indexOf("LinearCmd"))throw new Error("Device does not handle LinearCmd!");const n=[];for(let i=0;i<e.MessageAttributes("LinearCmd").FeatureCount;++i)n.push(new a.VectorSubcommand(i,t,r));return new a.LinearCmd(n)},t.CreateSimpleRotateCmd=function(e,t,r){if(-1===e.AllowedMessages.indexOf("RotateCmd"))throw new Error("Device does not handle RotateCmd!");const n=[];for(let i=0;i<e.MessageAttributes("RotateCmd").FeatureCount;++i)n.push(new a.RotateSubcommand(i,t,r));return new a.RotateCmd(n)}},function(e,t,r){"use strict";var n=r(10);function i(e,t,r){this.message=r||i.message(e,t),this.missingRef=n.url(e,t),this.missingSchema=n.normalizeId(n.fullPath(this.missingRef))}function a(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}e.exports={Validation:a(function(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0}),MissingRef:a(i)},i.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},function(e,t,r){"use strict";e.exports=function e(t,r){if(t===r)return!0;var n,i=Array.isArray(t),a=Array.isArray(r);if(i&&a){if(t.length!=r.length)return!1;for(n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}if(i!=a)return!1;if(t&&r&&"object"==typeof t&&"object"==typeof r){var s=Object.keys(t);if(s.length!==Object.keys(r).length)return!1;var o=t instanceof Date,c=r instanceof Date;if(o&&c)return t.getTime()==r.getTime();if(o!=c)return!1;var u=t instanceof RegExp,l=r instanceof RegExp;if(u&&l)return t.toString()==r.toString();if(u!=l)return!1;for(n=0;n<s.length;n++)if(!Object.prototype.hasOwnProperty.call(r,s[n]))return!1;for(n=0;n<s.length;n++)if(!e(t[s[n]],r[s[n]]))return!1;return!0}return!1}},function(e,t,r){"use strict";var n=r(29),i=r(9),a=r(5),s=r(24),o=r(76);function c(e,t,r){var n=this._refs[r];if("string"==typeof n){if(!this._refs[n])return c.call(this,e,t,n);n=this._refs[n]}if((n=n||this._schemas[r])instanceof s)return f(n.schema,this._opts.inlineRefs)?n.schema:n.validate||this._compile(n);var i,a,o,l=u.call(this,t,r);return l&&(i=l.schema,t=l.root,o=l.baseId),i instanceof s?a=i.validate||e.call(this,i.schema,t,void 0,o):void 0!==i&&(a=f(i,this._opts.inlineRefs)?i:e.call(this,i,t,void 0,o)),a}function u(e,t){var r=n.parse(t),i=m(r),a=p(this._getId(e.schema));if(i!==a){var o=g(i),c=this._refs[o];if("string"==typeof c)return function(e,t,r){var n=u.call(this,e,t);if(n){var i=n.schema,a=n.baseId;e=n.root;var s=this._getId(i);return s&&(a=y(a,s)),h.call(this,r,a,i,e)}}.call(this,e,c,r);if(c instanceof s)c.validate||this._compile(c),e=c;else{if(!((c=this._schemas[o])instanceof s))return;if(c.validate||this._compile(c),o==g(t))return{schema:c,root:e,baseId:a};e=c}if(!e.schema)return;a=p(this._getId(e.schema))}return h.call(this,r,a,e.schema,e)}e.exports=c,c.normalizeId=g,c.fullPath=p,c.url=y,c.ids=function(e){var t=g(this._getId(e)),r={"":t},s={"":p(t,!1)},c={},u=this;return o(e,{allKeys:!0},function(e,t,o,l,h,d,f){if(""!==t){var p=u._getId(e),m=r[l],v=s[l]+"/"+h;if(void 0!==f&&(v+="/"+("number"==typeof f?f:a.escapeFragment(f))),"string"==typeof p){p=m=g(m?n.resolve(m,p):p);var y=u._refs[p];if("string"==typeof y&&(y=u._refs[y]),y&&y.schema){if(!i(e,y.schema))throw new Error('id "'+p+'" resolves to more than one schema')}else if(p!=g(v))if("#"==p[0]){if(c[p]&&!i(e,c[p]))throw new Error('id "'+p+'" resolves to more than one schema');c[p]=e}else u._refs[p]=v}r[t]=m,s[t]=v}}),c},c.inlineRef=f,c.schema=u;var l=a.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function h(e,t,r,n){if(e.fragment=e.fragment||"","/"==e.fragment.slice(0,1)){for(var i=e.fragment.split("/"),s=1;s<i.length;s++){var o=i[s];if(o){if(void 0===(r=r[o=a.unescapeFragment(o)]))break;var c;if(!l[o]&&((c=this._getId(r))&&(t=y(t,c)),r.$ref)){var h=y(t,r.$ref),d=u.call(this,n,h);d&&(r=d.schema,n=d.root,t=d.baseId)}}}return void 0!==r&&r!==n.schema?{schema:r,root:n,baseId:t}:void 0}}var d=a.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function f(e,t){return!1!==t&&(void 0===t||!0===t?function e(t){var r;if(Array.isArray(t)){for(var n=0;n<t.length;n++)if("object"==typeof(r=t[n])&&!e(r))return!1}else for(var i in t){if("$ref"==i)return!1;if("object"==typeof(r=t[i])&&!e(r))return!1}return!0}(e):t?function e(t){var r,n=0;if(Array.isArray(t)){for(var i=0;i<t.length;i++)if("object"==typeof(r=t[i])&&(n+=e(r)),n==1/0)return 1/0}else for(var a in t){if("$ref"==a)return 1/0;if(d[a])n++;else if("object"==typeof(r=t[a])&&(n+=e(r)+1),n==1/0)return 1/0}return n}(e)<=t:void 0)}function p(e,t){return!1!==t&&(e=g(e)),m(n.parse(e))}function m(e){return n.serialize(e).split("#")[0]+"#"}var v=/#\/?$/;function g(e){return e?e.replace(v,""):""}function y(e,t){return t=g(t),n.resolve(e,t)}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(27),i=function(){function e(){}return e.prototype.classToPlain=function(e,t){return new n.TransformOperationExecutor(n.TransformationType.CLASS_TO_PLAIN,t||{}).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToPlainFromExist=function(e,t,r){return new n.TransformOperationExecutor(n.TransformationType.CLASS_TO_PLAIN,r||{}).transform(t,e,void 0,void 0,void 0,void 0)},e.prototype.plainToClass=function(e,t,r){return new n.TransformOperationExecutor(n.TransformationType.PLAIN_TO_CLASS,r||{}).transform(void 0,t,e,void 0,void 0,void 0)},e.prototype.plainToClassFromExist=function(e,t,r){return new n.TransformOperationExecutor(n.TransformationType.PLAIN_TO_CLASS,r||{}).transform(e,t,void 0,void 0,void 0,void 0)},e.prototype.classToClass=function(e,t){return new n.TransformOperationExecutor(n.TransformationType.CLASS_TO_CLASS,t||{}).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToClassFromExist=function(e,t,r){return new n.TransformOperationExecutor(n.TransformationType.CLASS_TO_CLASS,r||{}).transform(t,e,void 0,void 0,void 0,void 0)},e.prototype.serialize=function(e,t){return JSON.stringify(this.classToPlain(e,t))},e.prototype.deserialize=function(e,t,r){var n=JSON.parse(t);return this.plainToClass(e,n,r)},e.prototype.deserializeArray=function(e,t,r){var n=JSON.parse(t);return this.plainToClass(e,n,r)},e}();t.ClassTransformer=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);class i extends n.EventEmitter{static get Instance(){return i.sInstance}emitMessage(e){this.emit("message",e)}}i.sInstance=new i,t.ServerMessageHub=i},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),a=r(1);t.ButtplugDevice=class extends a.EventEmitter{constructor(e,t){super(),this._name=e,this._id=t,this.MsgFuncs=new Map,this.ParseMessage=(e=>n(this,void 0,void 0,function*(){return this.MsgFuncs.has(e.Type)?this.MsgFuncs.get(e.Type)(e):new i.Error(`${this._name} cannot handle message of type ${e.Type}`,i.ErrorClass.ERROR_MSG,e.Id)}))}get Name(){return this._name}get Id(){return this._id}get AllowedMessageTypes(){return Object.keys(this.MessageSpecifications)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(42),i=r(41),a=r(36),s=r(35),o=r(34);t.BluetoothDevices=class{static GetDeviceInfo(){return[n.FleshlightLaunch.DeviceInfo,i.LovenseRev1.DeviceInfo,i.LovenseRev2.DeviceInfo,i.LovenseRev3.DeviceInfo,i.LovenseRev4.DeviceInfo,i.LovenseRev5.DeviceInfo,i.LovenseRev6.DeviceInfo,i.LovenseRev7.DeviceInfo,i.LovenseRev8.DeviceInfo,o.Maxpro.DeviceInfo,a.VorzeA10Cyclone.DeviceInfo,s.WeVibe.DeviceInfo]}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),a=r(7),s=r(44),o=r(1),c=r(13),u=r(6);t.ButtplugServer=class extends o.EventEmitter{constructor(e="Buttplug JS Internal Server",t=0){super(),this._serverName=e,this._maxPingTime=t,this._clientSchemaVersion=-1,this._pingTimedOut=!1,this._receivedRequestServerInfo=!1,this._logger=u.ButtplugLogger.Logger,this._outgoingLogLevel=u.ButtplugLogLevel.Off,this.AddDeviceManager=(e=>{this._deviceManager.AddDeviceManager(e)}),this.ClearDeviceManagers=(()=>{this._deviceManager.ClearDeviceManagers()}),this.SendMessage=(e=>n(this,void 0,void 0,function*(){const t=e.Id;if(this._logger.Trace(`Server: Got Message: ${e}`),0===t)return this._logger.LogAndError("Message Id 0 is reserved for outgoing system messages. Please use another Id.",i.ErrorClass.ERROR_MSG,t);if(this._pingTimedOut)return this._logger.LogAndError("Ping timed out.",i.ErrorClass.ERROR_MSG,t);if(!this._receivedRequestServerInfo&&"RequestServerInfo"!==e.Type)return this._logger.LogAndError("RequestServerInfo must be first message received by server.",i.ErrorClass.ERROR_INIT,t);switch(e.Type){case"RequestLog":const r=e;return this._logger.Debug(`Server: RequestLog received for level ${r.LogLevel}`),r.LogLevel===u.ButtplugLogLevel[u.ButtplugLogLevel.Off]?this._logger.removeListener("log",this.OnLogMessage):this._outgoingLogLevel===u.ButtplugLogLevel.Off&&this._logger.addListener("log",this.OnLogMessage),this._logger.MaximumEventLogLevel=u.ButtplugLogLevel[r.LogLevel],this._outgoingLogLevel=u.ButtplugLogLevel[r.LogLevel],new i.Ok(r.Id);case"Ping":return new i.Ok(e.Id);case"RequestServerInfo":this._logger.Debug("Server: RequestServerInfo received.");const n=e;return this._clientSchemaVersion>1?new i.Error(`Client schema (${this._clientSchemaVersion}) newer than server schema (1). `+"Please upgrade server.",i.ErrorClass.ERROR_INIT,t):(this._receivedRequestServerInfo=!0,this._clientSchemaVersion=n.MessageVersion,this._clientName=n.ClientName,new i.ServerInfo(0,0,0,a.GetSchemaVersion(),this._maxPingTime,this._serverName,t));case"Test":this._logger.Debug("Server: Test received.");const s=e;return new i.Test(s.TestString,e.Id)}return this._deviceManager.SendMessage(e)})),this.Shutdown=(()=>n(this,void 0,void 0,function*(){c.ServerMessageHub.Instance.removeListener("message",this.OnOutgoingMessage),yield this._deviceManager.Shutdown()})),this.OnLogMessage=(e=>{e.LogLevel>this._outgoingLogLevel||this.OnOutgoingMessage(new i.Log(u.ButtplugLogLevel[e.LogLevel],e.Message))}),this.OnOutgoingMessage=(e=>{if("Error"===e.constructor.name)return e;if(-1===this._clientSchemaVersion)return new i.Error("Cannot discern client schema version. Was RequestServerInfo message sent?");for(;e.SchemaVersion!==this._clientSchemaVersion&&e.SchemaVersion>0;)e=e.DowngradeMessage();"Error"===e.constructor.name&&this._logger.Error(e.ErrorMessage),this.emit("message",e)}),this._logger.Info(`Server: Starting Buttplug Server: ${this._serverName}`),this._deviceManager=new s.DeviceManager,c.ServerMessageHub.Instance.addListener("message",this.OnOutgoingMessage)}get DeviceManagers(){return this._deviceManager.DeviceManagers}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),a=r(16);t.ButtplugEmbeddedServerConnector=class extends i.EventEmitter{constructor(){super(...arguments),this._connected=!1,this._server=null,this.Connect=(()=>n(this,void 0,void 0,function*(){return this._connected=!0,null===this._server&&(this._server=new a.ButtplugServer),this._server.addListener("message",this.OnMessageReceived),Promise.resolve()})),this.Disconnect=(()=>{this._connected&&(this._server.Shutdown(),this._connected=!1,this._server=null,this.emit("disconnect"))}),this.Send=(e=>n(this,void 0,void 0,function*(){if(!this._connected)throw new Error("ButtplugClient not connected");const t=yield this._server.SendMessage(e);this.emit("message",[t])})),this.OnMessageReceived=(e=>{this.emit("message",[e])})}set Server(e){this._server=e}get Server(){return this._server}get Connected(){return this._connected}}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],c=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&o&&o.$data;d?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",n="schema"+a):n=o,i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" Object.keys("+h+").length "+("maxProperties"==t?">":"<")+" "+n+") { ";var f=t,p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxProperties"==t?"more":"less",i+=" than ",i+=d?"' + "+n+" + '":""+o,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+c:""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var m=i;return i=p.pop(),!e.compositeRule&&l?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",l&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],c=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&o&&o.$data;d?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",n="schema"+a):n=o;var f="maxLength"==t?">":"<";i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),!1===e.opts.unicode?i+=" "+h+".length ":i+=" ucs2length("+h+") ",i+=" "+f+" "+n+") { ";var p=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(p||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be ",i+="maxLength"==t?"longer":"shorter",i+=" than ",i+=d?"' + "+n+" + '":""+o,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+c:""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var v=i;return i=m.pop(),!e.compositeRule&&l?e.async?i+=" throw new ValidationError(["+v+"]); ":i+=" validate.errors = ["+v+"]; return false; ":i+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",l&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],c=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&o&&o.$data;d?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",n="schema"+a):n=o,i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+h+".length "+("maxItems"==t?">":"<")+" "+n+") { ";var f=t,p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxItems"==t?"more":"less",i+=" than ",i+=d?"' + "+n+" + '":""+o,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+c:""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var m=i;return i=p.pop(),!e.compositeRule&&l?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",l&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],c=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&o&&o.$data;d?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",n="schema"+a):n=o;var f="maximum"==t,p=f?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[p],v=e.opts.$data&&m&&m.$data,g=f?"<":">",y=f?">":"<",P=void 0;if(v){var _,S=e.util.getData(m.$data,s,e.dataPathArr),w="exclusive"+a,E="exclType"+a,b="exclIsNumber"+a,x="' + "+(C="op"+a)+" + '";i+=" var schemaExcl"+a+" = "+S+"; ",i+=" var "+w+"; var "+E+" = typeof "+(S="schemaExcl"+a)+"; if ("+E+" != 'boolean' && "+E+" != 'undefined' && "+E+" != 'number') { ",P=p,(_=_||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(P||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: '"+p+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var I=i;i=_.pop(),!e.compositeRule&&l?e.async?i+=" throw new ValidationError(["+I+"]); ":i+=" validate.errors = ["+I+"]; return false; ":i+=" var err = "+I+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+E+" == 'number' ? ( ("+w+" = "+n+" === undefined || "+S+" "+g+"= "+n+") ? "+h+" "+y+"= "+S+" : "+h+" "+y+" "+n+" ) : ( ("+w+" = "+S+" === true) ? "+h+" "+y+"= "+n+" : "+h+" "+y+" "+n+" ) || "+h+" !== "+h+") { var op"+a+" = "+w+" ? '"+g+"' : '"+g+"='; ",void 0===o&&(P=p,u=e.errSchemaPath+"/"+p,n=S,d=v)}else if(x=g,(b="number"==typeof m)&&d){var C="'"+x+"'";i+=" if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" ( "+n+" === undefined || "+m+" "+g+"= "+n+" ? "+h+" "+y+"= "+m+" : "+h+" "+y+" "+n+" ) || "+h+" !== "+h+") { "}else b&&void 0===o?(w=!0,P=p,u=e.errSchemaPath+"/"+p,n=m,y+="="):(b&&(n=Math[f?"min":"max"](m,o)),m===(!b||n)?(w=!0,P=p,u=e.errSchemaPath+"/"+p,y+="="):(w=!1,x+="=")),C="'"+x+"'",i+=" if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+h+" "+y+" "+n+" || "+h+" !== "+h+") { ";return P=P||t,(_=_||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(P||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { comparison: "+C+", limit: "+n+", exclusive: "+w+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be "+x+" ",i+=d?"' + "+n:n+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+c:""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",I=i,i=_.pop(),!e.compositeRule&&l?e.async?i+=" throw new ValidationError(["+I+"]); ":i+=" validate.errors = ["+I+"]; return false; ":i+=" var err = "+I+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",l&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n="",i=!0===e.schema.$async,a=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),s=e.self._getId(e.schema);if(e.isTop&&(n+=" var validate = ",i&&(e.async=!0,n+="async "),n+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",s&&(e.opts.sourceCode||e.opts.processCode)&&(n+=" /*# sourceURL="+s+" */ ")),"boolean"==typeof e.schema||!a&&!e.schema.$ref){t="false schema";var o=e.level,c=e.dataLevel,u=e.schema[t],l=e.schemaPath+e.util.getProperty(t),h=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,f="data"+(c||""),p="valid"+o;if(!1===e.schema){e.isTop?d=!0:n+=" var "+p+" = false; ",(z=z||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'boolean schema is false' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";var m=n;n=z.pop(),!e.compositeRule&&d?e.async?n+=" throw new ValidationError(["+m+"]); ":n+=" validate.errors = ["+m+"]; return false; ":n+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?n+=i?" return data; ":" validate.errors = null; return true; ":n+=" var "+p+" = true; ";return e.isTop&&(n+=" }; return validate; "),n}if(e.isTop){var v=e.isTop;o=e.level=0,c=e.dataLevel=0,f="data",e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],n+=" var vErrors = null; ",n+=" var errors = 0;     ",n+=" if (rootData === undefined) rootData = data; "}else{if(o=e.level,f="data"+((c=e.dataLevel)||""),s&&(e.baseId=e.resolve.url(e.baseId,s)),i&&!e.async)throw new Error("async schema in sync schema");n+=" var errs_"+o+" = errors;"}p="valid"+o,d=!e.opts.allErrors;var g="",y="",P=e.schema.type,_=Array.isArray(P);if(_&&1==P.length&&(P=P[0],_=!1),e.schema.$ref&&a){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(a=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(n+=" "+e.RULES.all.$comment.code(e,"$comment")),P){if(e.opts.coerceTypes)var S=e.util.coerceToTypes(e.opts.coerceTypes,P);var w=e.RULES.types[P];if(S||_||!0===w||w&&!J(w)){l=e.schemaPath+".type",h=e.errSchemaPath+"/type",l=e.schemaPath+".type",h=e.errSchemaPath+"/type";var E=_?"checkDataTypes":"checkDataType";if(n+=" if ("+e.util[E](P,f,!0)+") { ",S){var b="dataType"+o,x="coerced"+o;n+=" var "+b+" = typeof "+f+"; ","array"==e.opts.coerceTypes&&(n+=" if ("+b+" == 'object' && Array.isArray("+f+")) "+b+" = 'array'; "),n+=" var "+x+" = undefined; ";var I="",C=S;if(C)for(var D,L=-1,M=C.length-1;L<M;)D=C[L+=1],L&&(n+=" if ("+x+" === undefined) { ",I+="}"),"array"==e.opts.coerceTypes&&"array"!=D&&(n+=" if ("+b+" == 'array' && "+f+".length == 1) { "+x+" = "+f+" = "+f+"[0]; "+b+" = typeof "+f+";  } "),"string"==D?n+=" if ("+b+" == 'number' || "+b+" == 'boolean') "+x+" = '' + "+f+"; else if ("+f+" === null) "+x+" = ''; ":"number"==D||"integer"==D?(n+=" if ("+b+" == 'boolean' || "+f+" === null || ("+b+" == 'string' && "+f+" && "+f+" == +"+f+" ","integer"==D&&(n+=" && !("+f+" % 1)"),n+=")) "+x+" = +"+f+"; "):"boolean"==D?n+=" if ("+f+" === 'false' || "+f+" === 0 || "+f+" === null) "+x+" = false; else if ("+f+" === 'true' || "+f+" === 1) "+x+" = true; ":"null"==D?n+=" if ("+f+" === '' || "+f+" === 0 || "+f+" === false) "+x+" = null; ":"array"==e.opts.coerceTypes&&"array"==D&&(n+=" if ("+b+" == 'string' || "+b+" == 'number' || "+b+" == 'boolean' || "+f+" == null) "+x+" = ["+f+"]; ");n+=" "+I+" if ("+x+" === undefined) {   ",(z=z||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",n+=_?""+P.join(","):""+P,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=_?""+P.join(","):""+P,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ",m=n,n=z.pop(),!e.compositeRule&&d?e.async?n+=" throw new ValidationError(["+m+"]); ":n+=" validate.errors = ["+m+"]; return false; ":n+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else {  ";var R=c?"data"+(c-1||""):"parentData",O=c?e.dataPathArr[c]:"parentDataProperty";n+=" "+f+" = "+x+"; ",c||(n+="if ("+R+" !== undefined)"),n+=" "+R+"["+O+"] = "+x+"; } "}else(z=z||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",n+=_?""+P.join(","):""+P,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=_?""+P.join(","):""+P,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ",m=n,n=z.pop(),!e.compositeRule&&d?e.async?n+=" throw new ValidationError(["+m+"]); ":n+=" validate.errors = ["+m+"]; return false; ":n+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";n+=" } "}}if(e.schema.$ref&&!a)n+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",d&&(n+=" } if (errors === ",n+=v?"0":"errs_"+o,n+=") { ",y+="}");else{var A=e.RULES;if(A)for(var T=-1,$=A.length-1;T<$;)if(J(w=A[T+=1])){if(w.type&&(n+=" if ("+e.util.checkDataType(w.type,f)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==w.type&&e.schema.properties){u=e.schema.properties;var F=Object.keys(u);if(F)for(var j,V=-1,k=F.length-1;V<k;)void 0!==(B=u[j=F[V+=1]]).default&&(n+="  if ("+(q=f+e.util.getProperty(j))+" === undefined) "+q+" = ","shared"==e.opts.useDefaults?n+=" "+e.useDefault(B.default)+" ":n+=" "+JSON.stringify(B.default)+" ",n+="; ")}else if("array"==w.type&&Array.isArray(e.schema.items)){var N=e.schema.items;if(N){L=-1;for(var B,U=N.length-1;L<U;){var q;void 0!==(B=N[L+=1]).default&&(n+="  if ("+(q=f+"["+L+"]")+" === undefined) "+q+" = ","shared"==e.opts.useDefaults?n+=" "+e.useDefault(B.default)+" ":n+=" "+JSON.stringify(B.default)+" ",n+="; ")}}}var z,H=w.rules;if(H)for(var Q,W=-1,Y=H.length-1;W<Y;)if(G(Q=H[W+=1])){var K=Q.code(e,Q.keyword,w.type);K&&(n+=" "+K+" ",d&&(g+="}"))}if(d&&(n+=" "+g+" ",g=""),w.type&&(n+=" } ",P&&P===w.type&&!S))n+=" else { ",l=e.schemaPath+".type",h=e.errSchemaPath+"/type",(z=z||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",n+=_?""+P.join(","):""+P,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=_?""+P.join(","):""+P,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ",m=n,n=z.pop(),!e.compositeRule&&d?e.async?n+=" throw new ValidationError(["+m+"]); ":n+=" validate.errors = ["+m+"]; return false; ":n+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ";d&&(n+=" if (errors === ",n+=v?"0":"errs_"+o,n+=") { ",y+="}")}}function J(e){for(var t=e.rules,r=0;r<t.length;r++)if(G(t[r]))return!0}function G(t){return void 0!==e.schema[t.keyword]||t.implements&&function(t){for(var r=t.implements,n=0;n<r.length;n++)if(void 0!==e.schema[r[n]])return!0}(t)}return d&&(n+=" "+y+" "),v?(i?(n+=" if (errors === 0) return data;           ",n+=" else throw new ValidationError(vErrors); "):(n+=" validate.errors = vErrors; ",n+=" return errors === 0;       "),n+=" }; return validate;"):n+=" var "+p+" = errors === errs_"+o+";",n=e.util.cleanUpCode(n),v&&(n=e.util.finalCleanUpCode(n,i)),n}},function(e,t,r){"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r,n="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(r=t.cmp,function(e){return function(t,n){var i={key:t,value:e[t]},a={key:n,value:e[n]};return r(i,a)}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var r,s;if(Array.isArray(t)){for(s="[",r=0;r<t.length;r++)r&&(s+=","),s+=e(t[r])||"null";return s+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=a.push(t)-1,c=Object.keys(t).sort(i&&i(t));for(s="",r=0;r<c.length;r++){var u=c[r],l=e(t[u]);l&&(s&&(s+=","),s+=JSON.stringify(u)+":"+l)}return a.splice(o,1),"{"+s+"}"}}(e)}},function(e,t,r){"use strict";var n=r(5);e.exports=function(e){n.copy(e,this)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e,t,r){this.index=e,this.name=t,this.allowedMsgs=new Map;for(const e of Object.keys(r))this.allowedMsgs.set(e,r[e])}static fromMsg(e){return new n(e.DeviceIndex,e.DeviceName,e.DeviceMessages)}get Name(){return this.name}get Index(){return this.index}get AllowedMessages(){return Array.from(this.allowedMsgs.keys())}MessageAttributes(e){if(-1===this.AllowedMessages.indexOf(e))throw new Error(`Message ${e} does not exist on device ${this.name}`);return this.allowedMsgs.get(e)}}t.Device=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(89);t.defaultMetadataStorage=new n.MetadataStorage},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i,a=r(26);(i=n=t.TransformationType||(t.TransformationType={}))[i.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",i[i.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",i[i.CLASS_TO_CLASS=2]="CLASS_TO_CLASS";var s=function(){function e(e,t){this.transformationType=e,this.options=t,this.transformedTypesMap=new Map}return e.prototype.transform=function(e,t,r,i,s,o){var c=this;if(void 0===o&&(o=0),t instanceof Array||t instanceof Set){var u=i&&this.transformationType===n.PLAIN_TO_CLASS?new i:[];return t.forEach(function(t,i){var a=e?e[i]:void 0;if(c.options.enableCircularCheck&&c.isCircular(t,o))c.transformationType===n.CLASS_TO_CLASS&&(u instanceof Set?u.add(t):u.push(t));else{var s=c.transform(a,t,r,void 0,t instanceof Map,o+1);u instanceof Set?u.add(s):u.push(s)}}),u}if(r!==String||s){if(r!==Number||s){if(r!==Boolean||s){if((r===Date||t instanceof Date)&&!s)return t instanceof Date?new Date(t.valueOf()):null===t||void 0===t?t:new Date(t);if("object"==typeof t&&null!==t){r||t.constructor===Object||(r=t.constructor),!r&&e&&(r=e.constructor),this.options.enableCircularCheck&&this.transformedTypesMap.set(t,{level:o,object:t});var l=this.getKeys(r,t),h=e||{};e||this.transformationType!==n.PLAIN_TO_CLASS&&this.transformationType!==n.CLASS_TO_CLASS||(h=s?new Map:r?new r:{});for(var d=function(i){var c=i,u=i,l=i;if(!f.options.ignoreDecorators&&r)if(f.transformationType===n.PLAIN_TO_CLASS)(d=a.defaultMetadataStorage.findExposeMetadataByCustomName(r,i))&&(l=d.propertyName,u=d.propertyName);else if(f.transformationType===n.CLASS_TO_PLAIN||f.transformationType===n.CLASS_TO_CLASS){var d;(d=a.defaultMetadataStorage.findExposeMetadata(r,i))&&d.options&&d.options.name&&(u=d.options.name)}var p,m=void 0,v=(p=t instanceof Map?t.get(c):t[c]instanceof Function?t[c]():t[c])instanceof Map;if(r&&s)m=r;else if(r){var g=a.defaultMetadataStorage.findTypeMetadata(r,l);if(g){var y={newObject:h,object:t,property:l};m=g.typeFunction(y),v=v||g.reflectedType===Map}else f.options.targetMaps&&f.options.targetMaps.filter(function(e){return e.target===r&&!!e.properties[l]}).forEach(function(e){return m=e.properties[l]})}var P=t[c]instanceof Array?f.getReflectedType(r,l):void 0,_=e?e[c]:void 0;if(h.constructor.prototype){var S=Object.getOwnPropertyDescriptor(h.constructor.prototype,u);if((f.transformationType===n.PLAIN_TO_CLASS||f.transformationType===n.CLASS_TO_CLASS)&&(h[u]instanceof Function||S&&!S.set))return"continue"}if(f.options.enableCircularCheck&&f.isCircular(p,o))f.transformationType===n.CLASS_TO_CLASS&&(E=p,E=f.applyCustomTransformations(E,r,i,t,f.transformationType),h instanceof Map?h.set(u,E):h[u]=E);else{var w=f.transformationType===n.PLAIN_TO_CLASS?u:i,E=f.transform(_,p,m,P,v,o+1);E=f.applyCustomTransformations(E,r,w,t,f.transformationType),h instanceof Map?h.set(u,E):h[u]=E}},f=this,p=0,m=l;p<m.length;p++)d(m[p]);return h}return t}return Boolean(t)}return Number(t)}return String(t)},e.prototype.applyCustomTransformations=function(e,t,r,n,i){var s=this,o=a.defaultMetadataStorage.findTransformMetadatas(t,r,this.transformationType);return void 0!==this.options.version&&(o=o.filter(function(e){return!e.options||s.checkVersion(e.options.since,e.options.until)})),(o=this.options.groups&&this.options.groups.length?o.filter(function(e){return!e.options||s.checkGroups(e.options.groups)}):o.filter(function(e){return!e.options||!e.options.groups||!e.options.groups.length})).forEach(function(t){e=t.transformFn(e,n,i)}),e},e.prototype.isCircular=function(e,t){var r=this.transformedTypesMap.get(e);return void 0!==r&&r.level<t},e.prototype.getReflectedType=function(e,t){if(e){var r=a.defaultMetadataStorage.findTypeMetadata(e,t);return r?r.reflectedType:void 0}},e.prototype.getKeys=function(e,t){var r=this,i=a.defaultMetadataStorage.getStrategy(e);"none"===i&&(i=this.options.strategy||"exposeAll");var s=[];if("exposeAll"===i&&(s=t instanceof Map?Array.from(t.keys()):Object.keys(t)),!this.options.ignoreDecorators&&e){var o=a.defaultMetadataStorage.getExposedProperties(e,this.transformationType);this.transformationType===n.PLAIN_TO_CLASS&&(o=o.map(function(t){var r=a.defaultMetadataStorage.findExposeMetadata(e,t);return r&&r.options&&r.options.name?r.options.name:t})),s=s.concat(o);var c=a.defaultMetadataStorage.getExcludedProperties(e,this.transformationType);c.length>0&&(s=s.filter(function(e){return-1===c.indexOf(e)})),void 0!==this.options.version&&(s=s.filter(function(t){var n=a.defaultMetadataStorage.findExposeMetadata(e,t);return!n||!n.options||r.checkVersion(n.options.since,n.options.until)})),s=this.options.groups&&this.options.groups.length?s.filter(function(t){var n=a.defaultMetadataStorage.findExposeMetadata(e,t);return!n||!n.options||r.checkGroups(n.options.groups)}):s.filter(function(t){var r=a.defaultMetadataStorage.findExposeMetadata(e,t);return!(r&&r.options&&r.options.groups&&r.options.groups.length)})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(s=s.filter(function(e){return r.options.excludePrefixes.every(function(t){return e.substr(0,t.length)!==t})})),s.filter(function(e,t,r){return r.indexOf(e)===t})},e.prototype.checkVersion=function(e,t){var r=!0;return r&&e&&(r=this.options.version>=e),r&&t&&(r=this.options.version<t),r},e.prototype.checkGroups=function(e){return!e||this.options.groups.some(function(t){return-1!==e.indexOf(t)})},e}();t.TransformOperationExecutor=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(12);t.ClassTransformer=i.ClassTransformer,function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(88));var a,s=new n.ClassTransformer;t.classToPlain=function(e,t){return s.classToPlain(e,t)},t.classToPlainFromExist=function(e,t,r){return s.classToPlainFromExist(e,t,r)},t.plainToClass=function(e,t,r){return s.plainToClass(e,t,r)},t.plainToClassFromExist=function(e,t,r){return s.plainToClassFromExist(e,t,r)},t.classToClass=function(e,t){return s.classToClass(e,t)},t.classToClassFromExist=function(e,t,r){return s.classToClassFromExist(e,t,r)},t.serialize=function(e,t){return s.serialize(e,t)},t.deserialize=function(e,t,r){return s.deserialize(e,t,r)},t.deserializeArray=function(e,t,r){return s.deserializeArray(e,t,r)},(a=t.TransformationType||(t.TransformationType={}))[a.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",a[a.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",a[a.CLASS_TO_CLASS=2]="CLASS_TO_CLASS"},function(e,t,r){"use strict";function n(...e){if(e.length>1){e[0]=e[0].slice(0,-1);const t=e.length-1;for(let r=1;r<t;++r)e[r]=e[r].slice(1,-1);return e[t]=e[t].slice(1),e.join("")}return e[0]}function i(e){return"(?:"+e+")"}function a(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function s(e){return e.toUpperCase()}function o(e){const t="[A-Za-z]",r=n("[0-9]","[A-Fa-f]"),a=i(i("%[EFef]"+r+"%"+r+r+"%"+r+r)+"|"+i("%[89A-Fa-f]"+r+"%"+r+r)+"|"+i("%"+r+r)),s="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",o=n("[\\:\\/\\?\\#\\[\\]\\@]",s),c=e?"[\\uE000-\\uF8FF]":"[]",u=n(t,"[0-9]","[\\-\\.\\_\\~]",e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]"),l=i(t+n(t,"[0-9]","[\\+\\-\\.]")+"*"),h=i(i(a+"|"+n(u,s,"[\\:]"))+"*"),d=i(i("25[0-5]")+"|"+i("2[0-4][0-9]")+"|"+i("1[0-9][0-9]")+"|"+i("[1-9][0-9]")+"|[0-9]"),f=i(d+"\\."+d+"\\."+d+"\\."+d),p=i(r+"{1,4}"),m=i(i(p+"\\:"+p)+"|"+f),v=i([i(i(p+"\\:")+"{6}"+m),i("\\:\\:"+i(p+"\\:")+"{5}"+m),i(i(p)+"?\\:\\:"+i(p+"\\:")+"{4}"+m),i(i(i(p+"\\:")+"{0,1}"+p)+"?\\:\\:"+i(p+"\\:")+"{3}"+m),i(i(i(p+"\\:")+"{0,2}"+p)+"?\\:\\:"+i(p+"\\:")+"{2}"+m),i(i(i(p+"\\:")+"{0,3}"+p)+"?\\:\\:"+p+"\\:"+m),i(i(i(p+"\\:")+"{0,4}"+p)+"?\\:\\:"+m),i(i(i(p+"\\:")+"{0,5}"+p)+"?\\:\\:"+p),i(i(i(p+"\\:")+"{0,6}"+p)+"?\\:\\:")].join("|")),g=i("\\["+i(v+"|"+i("[vV]"+r+"+\\."+n(u,s,"[\\:]")+"+"))+"\\]"),y=i(i(a+"|"+n(u,s))+"*"),P=i(g+"|"+f+"(?!"+y+")|"+y),_=i("[0-9]*"),S=i(i(h+"@")+"?"+P+i("\\:"+_)+"?"),w=i(a+"|"+n(u,s,"[\\:\\@]")),E=i(w+"*"),b=i(w+"+"),x=i(i(a+"|"+n(u,s,"[\\@]"))+"+"),I=i(i("\\/"+E)+"*"),C=i("\\/"+i(b+I)+"?"),D=i(x+I),L=i(b+I),M="(?!"+w+")",R=(i(I+"|"+C+"|"+D+"|"+L+"|"+M),i(i(w+"|"+n("[\\/\\?]",c))+"*")),O=i(i(w+"|[\\/\\?]")+"*"),A=i(i("\\/\\/"+S+I)+"|"+C+"|"+L+"|"+M);return i(i(l+"\\:"+A+i("\\?"+R)+"?"+i("\\#"+O)+"?")+"|"+i(i(i("\\/\\/"+S+I)+"|"+C+"|"+D+"|"+M)+i("\\?"+R)+"?"+i("\\#"+O)+"?")),i(l+"\\:"+A+i("\\?"+R)+"?"),i(i("\\/\\/("+i("("+h+")@")+"?("+P+")"+i("\\:("+_+")")+"?)")+"?("+I+"|"+C+"|"+L+"|"+M+")"),i("\\?("+R+")"),i("\\#("+O+")"),i(i("\\/\\/("+i("("+h+")@")+"?("+P+")"+i("\\:("+_+")")+"?)")+"?("+I+"|"+C+"|"+D+"|"+M+")"),i("\\?("+R+")"),i("\\#("+O+")"),i(i("\\/\\/("+i("("+h+")@")+"?("+P+")"+i("\\:("+_+")")+"?)")+"?("+I+"|"+C+"|"+L+"|"+M+")"),i("\\?("+R+")"),i("\\#("+O+")"),i("("+h+")@"),i("\\:("+_+")"),{NOT_SCHEME:new RegExp(n("[^]",t,"[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(n("[^\\%\\:]",u,s),"g"),NOT_HOST:new RegExp(n("[^\\%\\[\\]\\:]",u,s),"g"),NOT_PATH:new RegExp(n("[^\\%\\/\\:\\@]",u,s),"g"),NOT_PATH_NOSCHEME:new RegExp(n("[^\\%\\/\\@]",u,s),"g"),NOT_QUERY:new RegExp(n("[^\\%]",u,s,"[\\:\\@\\/\\?]",c),"g"),NOT_FRAGMENT:new RegExp(n("[^\\%]",u,s,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(n("[^]",u,s),"g"),UNRESERVED:new RegExp(u,"g"),OTHER_CHARS:new RegExp(n("[^\\%]",u,o),"g"),PCT_ENCODED:new RegExp(a,"g"),IPV6ADDRESS:new RegExp("\\[?("+v+")\\]?","g")}}r.r(t);var c=o(!1),u=o(!0),l=r(2),h=r.n(l);const d={};function f(e){const t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function p(e){let t="",r=0;const n=e.length;for(;r<n;){const i=parseInt(e.substr(r+1,2),16);if(i<128)t+=String.fromCharCode(i),r+=3;else if(i>=194&&i<224){if(n-r>=6){const n=parseInt(e.substr(r+4,2),16);t+=String.fromCharCode((31&i)<<6|63&n)}else t+=e.substr(r,6);r+=6}else if(i>=224){if(n-r>=9){const n=parseInt(e.substr(r+4,2),16),a=parseInt(e.substr(r+7,2),16);t+=String.fromCharCode((15&i)<<12|(63&n)<<6|63&a)}else t+=e.substr(r,9);r+=9}else t+=e.substr(r,3),r+=3}return t}function m(e,t){function r(e){const r=p(e);return r.match(t.UNRESERVED)?r:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,r).replace(t.NOT_USERINFO,f).replace(t.PCT_ENCODED,s)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_HOST,f).replace(t.PCT_ENCODED,s)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,r).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,f).replace(t.PCT_ENCODED,s)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,r).replace(t.NOT_QUERY,f).replace(t.PCT_ENCODED,s)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,r).replace(t.NOT_FRAGMENT,f).replace(t.PCT_ENCODED,s)),e}const v=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[\dA-F:.]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,g=void 0==="".match(/(){0}/)[1];function y(e,t={}){const r={},n=!1!==t.iri?u:c;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);const i=e.match(v);if(i){g?(r.scheme=i[1],r.userinfo=i[3],r.host=i[4],r.port=parseInt(i[5],10),r.path=i[6]||"",r.query=i[7],r.fragment=i[8],isNaN(r.port)&&(r.port=i[5])):(r.scheme=i[1]||void 0,r.userinfo=-1!==e.indexOf("@")?i[3]:void 0,r.host=-1!==e.indexOf("//")?i[4]:void 0,r.port=parseInt(i[5],10),r.path=i[6]||"",r.query=-1!==e.indexOf("?")?i[7]:void 0,r.fragment=-1!==e.indexOf("#")?i[8]:void 0,isNaN(r.port)&&(r.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?i[4]:void 0)),r.host&&(r.host=r.host.replace(n.IPV6ADDRESS,"$1")),void 0!==r.scheme||void 0!==r.userinfo||void 0!==r.host||void 0!==r.port||r.path||void 0!==r.query?void 0===r.scheme?r.reference="relative":void 0===r.fragment?r.reference="absolute":r.reference="uri":r.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==r.reference&&(r.error=r.error||"URI is not a "+t.reference+" reference.");const a=d[(t.scheme||r.scheme||"").toLowerCase()];if(t.unicodeSupport||a&&a.unicodeSupport)m(r,n);else{if(r.host&&(t.domainHost||a&&a.domainHost))try{r.host=h.a.toASCII(r.host.replace(n.PCT_ENCODED,p).toLowerCase())}catch(e){r.error=r.error||"Host's domain name can not be converted to ASCII via punycode: "+e}m(r,c)}a&&a.parse&&a.parse(r,t)}else r.error=r.error||"URI can not be parsed.";return r}const P=/^\.\.?\//,_=/^\/\.(\/|$)/,S=/^\/\.\.(\/|$)/,w=/^\/?(?:.|\n)*?(?=\/|$)/;function E(e){const t=[];for(;e.length;)if(e.match(P))e=e.replace(P,"");else if(e.match(_))e=e.replace(_,"/");else if(e.match(S))e=e.replace(S,"/"),t.pop();else if("."===e||".."===e)e="";else{const r=e.match(w);if(!r)throw new Error("Unexpected dot segment condition");{const n=r[0];e=e.slice(n.length),t.push(n)}}return t.join("")}function b(e,t={}){const r=t.iri?u:c,n=[],i=d[(t.scheme||e.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(e,t),e.host)if(r.IPV6ADDRESS.test(e.host));else if(t.domainHost||i&&i.domainHost)try{e.host=t.iri?h.a.toUnicode(e.host):h.a.toASCII(e.host.replace(r.PCT_ENCODED,p).toLowerCase())}catch(r){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+r}m(e,r),"suffix"!==t.reference&&e.scheme&&(n.push(e.scheme),n.push(":"));const a=function(e,t){const r=!1!==t.iri?u:c,n=[];return void 0!==e.userinfo&&(n.push(e.userinfo),n.push("@")),void 0!==e.host&&n.push(String(e.host).replace(r.IPV6ADDRESS,"[$1]")),"number"==typeof e.port&&(n.push(":"),n.push(e.port.toString(10))),n.length?n.join(""):void 0}(e,t);if(void 0!==a&&("suffix"!==t.reference&&n.push("//"),n.push(a),e.path&&"/"!==e.path.charAt(0)&&n.push("/")),void 0!==e.path){let r=e.path;t.absolutePath||i&&i.absolutePath||(r=E(r)),void 0===a&&(r=r.replace(/^\/\//,"/%2F")),n.push(r)}return void 0!==e.query&&(n.push("?"),n.push(e.query)),void 0!==e.fragment&&(n.push("#"),n.push(e.fragment)),n.join("")}function x(e,t,r={},n){const i={};return n||(e=y(b(e,r),r),t=y(b(t,r),r)),!(r=r||{}).tolerant&&t.scheme?(i.scheme=t.scheme,i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=E(t.path||""),i.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=E(t.path||""),i.query=t.query):(t.path?("/"===t.path.charAt(0)?i.path=E(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?i.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:i.path=t.path:i.path="/"+t.path,i.path=E(i.path)),i.query=t.query):(i.path=e.path,void 0!==t.query?i.query=t.query:i.query=e.query),i.userinfo=e.userinfo,i.host=e.host,i.port=e.port),i.scheme=e.scheme),i.fragment=t.fragment,i}function I(e,t,r){return b(x(y(e,r),y(t,r),r,!0),r)}function C(e,t){return"string"==typeof e?e=b(y(e,t),t):"object"===a(e)&&(e=y(b(e,t),t)),e}function D(e,t,r){return"string"==typeof e?e=b(y(e,r),r):"object"===a(e)&&(e=b(e,r)),"string"==typeof t?t=b(y(t,r),r):"object"===a(t)&&(t=b(t,r)),e===t}function L(e,t){return e&&e.toString().replace(t&&t.iri?u.ESCAPE:c.ESCAPE,f)}function M(e,t){return e&&e.toString().replace(t&&t.iri?u.PCT_ENCODED:c.PCT_ENCODED,p)}var R={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},O={scheme:"https",domainHost:R.domainHost,parse:R.parse,serialize:R.serialize};const A={},T="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",$="[0-9A-Fa-f]",F=i(i("%[EFef]"+$+"%"+$+$+"%"+$+$)+"|"+i("%[89A-Fa-f]"+$+"%"+$+$)+"|"+i("%"+$+$)),j="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",V="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",k=n(V,'[\\"\\\\]'),N=i(j+"+"+i("\\."+j+"+")+"*"),B=i('\\"'+i(V+"|"+i("\\\\"+k))+'*\\"'),U="[\\x21-\\x5A\\x5E-\\x7E]",q="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",z=i(T+"|"+F+"|"+q),H=i(N+"|\\["+U+"*\\]"),Q=i(i(N+"|"+B)+"\\@"+H),W=i(Q+i("\\,"+Q)+"*"),Y=i(z+"*"),K=i(Y+"\\="+Y),J=i(K+i("\\&"+K)+"*"),G=i("\\?"+J),Z=(new RegExp("^mailto\\:"+W+"?"+G+"?$"),new RegExp(T,"g")),X=new RegExp(F,"g"),ee=new RegExp(n("[^]",j,"[\\.]",'[\\"]',k),"g"),te=(new RegExp(n("[^]",j,"[\\.]","[\\[]",U,"[\\]]"),"g"),new RegExp(n("[^]",T,q),"g")),re=te;function ne(e){const t=p(e);return t.match(Z)?t:e}new RegExp("^"+W+"$"),new RegExp("^"+J+"$");var ie={scheme:"mailto",parse:function(e,t){const r=e.to=e.path?e.path.split(","):[];if(e.path=void 0,e.query){let n=!1;const i={},a=e.query.split("&");for(let s=0,o=a.length;s<o;++s){const o=a[s].split("=");switch(o[0]){case"to":const a=o[1].split(",");for(let e=0,t=a.length;e<t;++e)r.push(a[e]);break;case"subject":e.subject=M(o[1],t);break;case"body":e.body=M(o[1],t);break;default:n=!0,i[M(o[0],t)]=M(o[1],t)}}n&&(e.headers=i)}e.query=void 0;for(let n=0,i=r.length;n<i;++n){const i=r[n].split("@");if(i[0]=M(i[0]),t.unicodeSupport)i[1]=M(i[1],t).toLowerCase();else try{i[1]=h.a.toASCII(M(i[1],t).toLowerCase())}catch(t){e.error=e.error||"Email address's domain name can not be converted to ASCII via punycode: "+t}r[n]=i.join("@")}return e},serialize:function(e,t){const r=void 0!==(n=e.to)&&null!==n?n instanceof Array?n:"number"!=typeof n.length||n.split||n.setInterval||n.call?[n]:Array.prototype.slice.call(n):[];var n;if(r){for(let n=0,i=r.length;n<i;++n){const i=String(r[n]),a=i.lastIndexOf("@"),o=i.slice(0,a).replace(X,ne).replace(X,s).replace(ee,f);let c=i.slice(a+1);try{c=t.iri?h.a.toUnicode(c):h.a.toASCII(M(c,t).toLowerCase())}catch(r){e.error=e.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+r}r[n]=o+"@"+c}e.path=r.join(",")}const i=e.headers=e.headers||{};e.subject&&(i.subject=e.subject),e.body&&(i.body=e.body);const a=[];for(const e in i)i[e]!==A[e]&&a.push(e.replace(X,ne).replace(X,s).replace(te,f)+"="+i[e].replace(X,ne).replace(X,s).replace(re,f));return a.length&&(e.query=a.join("&")),e}};const ae="(?:[0-9A-Za-z][0-9A-Za-z\\-]{1,31})",se=new RegExp("^urn\\:("+ae+")$"),oe=(new RegExp("^("+ae+")\\:((?:(?:(?:\\%[0-9A-Fa-f]{2})|[0-9A-Za-z\\(\\)\\+\\,\\-\\.\\:\\=\\@\\;\\$\\_\\!\\*\\'\\/\\?\\#])+))$"),/^([^\:]+)\:(.*)/),ce=/[\x00-\x20\\\"\&\<\>\[\]\^\`\{\|\}\~\x7F-\xFF]/g;var ue={scheme:"urn",parse:function(e,t){const r=e.path&&e.path.match(oe);if(r){const n="urn:"+r[1].toLowerCase();let i=d[n];i||(i=d[n]={scheme:n,parse:function(e,t){return e},serialize:d.urn.serialize}),e.scheme=n,e.path=r[2],e=i.parse(e,t)}else e.error=e.error||"URN can not be parsed.";return e},serialize:function(e,t){const r=e.scheme||t.scheme;if(r&&"urn"!==r){const t=r.match(se)||["urn:"+r,r];e.scheme="urn",e.path=t[1]+":"+(e.path?e.path.replace(ce,f):"")}return e}};const le=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/;var he={scheme:"urn:uuid",parse:function(e,t){return t.tolerant||e.path&&e.path.match(le)||(e.error=e.error||"UUID is not valid."),e},serialize:function(e,t){return t.tolerant||e.path&&e.path.match(le)?e.path=(e.path||"").toLowerCase():e.scheme=void 0,d.urn.serialize(e,t)}};r.d(t,"SCHEMES",function(){return d}),r.d(t,"pctEncChar",function(){return f}),r.d(t,"pctDecChars",function(){return p}),r.d(t,"parse",function(){return y}),r.d(t,"removeDotSegments",function(){return E}),r.d(t,"serialize",function(){return b}),r.d(t,"resolveComponents",function(){return x}),r.d(t,"resolve",function(){return I}),r.d(t,"normalize",function(){return C}),r.d(t,"equal",function(){return D}),r.d(t,"escapeComponent",function(){return L}),r.d(t,"unescapeComponent",function(){return M}),d.http=R,d.https=O,d.mailto=ie,d.urn=ue,d["urn:uuid"]=he},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(6),a=r(1);class s extends a.EventEmitter{constructor(e,t){super(),this._deviceInfo=e,this._device=t,this._logger=i.ButtplugLogger.Logger,this._characteristics=new Map,this.Connect=(()=>n(this,void 0,void 0,function*(){this._logger.Debug(`WebBluetoothDevice: ${this.constructor.name} connecting`),this._device.addEventListener("gattserverdisconnected",this.OnDisconnect),this._server=yield this._device.gatt.connect(),this._service=yield this._server.getPrimaryService(this._deviceInfo.Services[0]);for(const e of Object.getOwnPropertyNames(this._deviceInfo.Characteristics))this._characteristics.set(e,yield this._service.getCharacteristic(this._deviceInfo.Characteristics[e]))})),this.Disconnect=(()=>n(this,void 0,void 0,function*(){this._server.disconnect()})),this.OnDisconnect=(()=>{this._logger.Debug(`WebBluetoothDevice: ${this.constructor.name} disconnecting`),this._device.removeEventListener("gattserverdisconnected",this.OnDisconnect),this.emit("deviceremoved")}),this.WriteValue=((e,t)=>n(this,void 0,void 0,function*(){if(!this._characteristics.has(e))return;const r=this._characteristics.get(e);this._logger.Trace(`WebBluetoothDevice: ${this.constructor.name} writing ${t} to ${r.uuid}`),yield r.writeValue(t)})),this.ReadValue=(e=>n(this,void 0,void 0,function*(){if(!this._characteristics.has(e))throw new Error("Tried to access wrong characteristic!");const t=this._characteristics.get(e);return this._logger.Trace(`WebBluetoothDevice: ${this.constructor.name} reading from ${t.uuid}`),yield t.readValue()}))}static CreateDevice(e,t){return n(this,void 0,void 0,function*(){const r=new s(e,t);yield r.Connect();const n=yield e.Create(r);return r.addListener("deviceremoved",()=>{n.OnDisconnect()}),i.ButtplugLogger.Logger.Debug(`WebBluetoothDevice: Creating ${n.constructor.name}`),n})}get Name(){return this._device.name}get Id(){return this._device.id}}t.WebBluetoothDevice=s},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),a=r(3),s=r(0);class o extends a.ButtplugBluetoothDevice{constructor(e){super(`Maxpro ${e.Name}`,e),this.HandleVibrateCmd=(e=>n(this,void 0,void 0,function*(){return 1!==e.Speeds.length?new s.Error("Maxpro devices require VibrateCmd to have 1 speed command, "+`${e.Speeds.length} sent.`,s.ErrorClass.ERROR_DEVICE,e.Id):yield this.HandleSingleMotorVibrateCmd(new s.SingleMotorVibrateCmd(e.Speeds[0].Speed,e.DeviceIndex,e.Id))})),this.HandleStopDeviceCmd=(e=>n(this,void 0,void 0,function*(){return yield this.HandleSingleMotorVibrateCmd(new s.SingleMotorVibrateCmd(0,e.DeviceIndex,e.Id))})),this.HandleSingleMotorVibrateCmd=(e=>n(this,void 0,void 0,function*(){const t=Math.floor(100*e.Speed),r=new Uint8Array([85,4,7,255,255,63,t,95,t,0]),n=255&r.reduce((e,t)=>e+t);return r[9]=n,yield this._deviceImpl.WriteValue("tx",r),new s.Ok(e.Id)})),this.MsgFuncs.set(s.StopDeviceCmd.name,this.HandleStopDeviceCmd),this.MsgFuncs.set(s.SingleMotorVibrateCmd.name,this.HandleSingleMotorVibrateCmd),this.MsgFuncs.set(s.VibrateCmd.name,this.HandleVibrateCmd)}static CreateInstance(e){return n(this,void 0,void 0,function*(){return new o(e)})}get MessageSpecifications(){return{VibrateCmd:{FeatureCount:1},SingleMotorVibrateCmd:{},StopDeviceCmd:{}}}}o.DeviceInfo=new i.BluetoothDeviceInfo(["M2"],["6e400001-b5a3-f393-e0a9-e50e24dcca9e"],{tx:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",rx:"6e400003-b5a3-f393-e0a9-e50e24dcca9e"},o.CreateInstance),t.Maxpro=o},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),a=r(3),s=r(0);class o extends a.ButtplugBluetoothDevice{constructor(e){super(`WeVibe ${e.Name}`,e),this.HandleVibrateCmd=(e=>n(this,void 0,void 0,function*(){return 1!==e.Speeds.length?new s.Error("WeVibe devices require VibrateCmd to have 1 speed command, "+`${e.Speeds.length} sent.`,s.ErrorClass.ERROR_DEVICE,e.Id):yield this.HandleSingleMotorVibrateCmd(new s.SingleMotorVibrateCmd(e.Speeds[0].Speed,e.DeviceIndex,e.Id))})),this.HandleStopDeviceCmd=(e=>n(this,void 0,void 0,function*(){return yield this.HandleSingleMotorVibrateCmd(new s.SingleMotorVibrateCmd(0,e.DeviceIndex,e.Id))})),this.HandleSingleMotorVibrateCmd=(e=>n(this,void 0,void 0,function*(){const t=Math.floor(15*e.Speed),r=new Uint8Array([15,3,0,t<<4|t,0,3,0,0]);return yield this._deviceImpl.WriteValue("tx",r),new s.Ok(e.Id)})),this.MsgFuncs.set(s.StopDeviceCmd.name,this.HandleStopDeviceCmd),this.MsgFuncs.set(s.SingleMotorVibrateCmd.name,this.HandleSingleMotorVibrateCmd),this.MsgFuncs.set(s.VibrateCmd.name,this.HandleVibrateCmd)}static CreateInstance(e){return n(this,void 0,void 0,function*(){return new o(e)})}get MessageSpecifications(){return{VibrateCmd:{FeatureCount:1},SingleMotorVibrateCmd:{},StopDeviceCmd:{}}}}o.DeviceInfo=new i.BluetoothDeviceInfo(["4 Plus","Ditto","Nova","Wish","Pivot","Verge","Cougar","Sync"],["f000bb03-0451-4000-b000-000000000000"],{tx:"f000c000-0451-4000-b000-000000000000",rx:"f000b000-0451-4000-b000-000000000000"},o.CreateInstance),t.WeVibe=o},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),a=r(3),s=r(0);class o extends a.ButtplugBluetoothDevice{constructor(e){super("Vorze A10 Cyclone",e),this.HandleRotateCmd=(e=>n(this,void 0,void 0,function*(){return 1!==e.Rotations.length?new s.Error("Vorze A10 Cyclone devices require RotateCmd to have 1 rotation command,"+` ${e.Rotations.length} sent.`,s.ErrorClass.ERROR_DEVICE,e.Id):yield this.HandleVorzeA10CycloneCmd(new s.VorzeA10CycloneCmd(100*e.Rotations[0].Speed,e.Rotations[0].Clockwise,e.DeviceIndex,e.Id))})),this.HandleStopDeviceCmd=(e=>n(this,void 0,void 0,function*(){return yield this.HandleVorzeA10CycloneCmd(new s.VorzeA10CycloneCmd(0,!1,e.DeviceIndex,e.Id))})),this.HandleVorzeA10CycloneCmd=(e=>n(this,void 0,void 0,function*(){const t=255&((e.Clockwise?1:0)<<7|e.Speed);return yield this._deviceImpl.WriteValue("tx",new Uint8Array([1,1,t])),new s.Ok(e.Id)})),this.MsgFuncs.set(s.StopDeviceCmd.name,this.HandleStopDeviceCmd),this.MsgFuncs.set(s.VorzeA10CycloneCmd.name,this.HandleVorzeA10CycloneCmd),this.MsgFuncs.set(s.RotateCmd.name,this.HandleRotateCmd)}static CreateInstance(e){return n(this,void 0,void 0,function*(){return e.WriteValue("cmd",new Uint8Array([0])),new o(e)})}get MessageSpecifications(){return{RotateCmd:{FeatureCount:1},VorzeA10CycloneCmd:{},StopDeviceCmd:{}}}}o.DeviceInfo=new i.BluetoothDeviceInfo(["CycSA"],["40ee1111-63ec-4b7f-8ce7-712efd55b90e"],{tx:"40ee2222-63ec-4b7f-8ce7-712efd55b90e"},o.CreateInstance),t.VorzeA10Cyclone=o},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t){t.read=function(e,t,r,n,i){var a,s,o=8*i-n-1,c=(1<<o)-1,u=c>>1,l=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-l)-1,f>>=-l,l+=o;l>0;a=256*a+e[t+h],h+=d,l-=8);for(s=a&(1<<-l)-1,a>>=-l,l+=n;l>0;s=256*s+e[t+h],h+=d,l-=8);if(0===a)a=1-u;else{if(a===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),a-=u}return(f?-1:1)*s*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var s,o,c,u=8*a-i-1,l=(1<<u)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=l?(o=0,s=l):s+h>=1?(o=(t*c-1)*Math.pow(2,i),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(s=s<<i|o,u+=i;u>0;e[r+f]=255&s,f+=p,s/=256,u-=8);e[r+f-p]|=128*m}},function(e,t,r){"use strict";t.byteLength=function(e){return 3*e.length/4-u(e)},t.toByteArray=function(e){var t,r,n,s,o,c=e.length;s=u(e),o=new a(3*c/4-s),r=s>0?c-4:c;var l=0;for(t=0;t<r;t+=4)n=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],o[l++]=n>>16&255,o[l++]=n>>8&255,o[l++]=255&n;return 2===s?(n=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,o[l++]=255&n):1===s&&(n=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,o[l++]=n>>8&255,o[l++]=255&n),o},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a="",s=[],o=0,c=r-i;o<c;o+=16383)s.push(l(e,o,o+16383>c?c:o+16383));return 1===i?(t=e[r-1],a+=n[t>>2],a+=n[t<<4&63],a+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],a+=n[t>>10],a+=n[t>>4&63],a+=n[t<<2&63],a+="="),s.push(a),s.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,c=s.length;o<c;++o)n[o]=s[o],i[s.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function l(e,t,r){for(var i,a,s=[],o=t;o<r;o+=3)i=(e[o]<<16)+(e[o+1]<<8)+e[o+2],s.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(39),i=r(38),a=r(37);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=d(e,t),e}(e,t,r,n):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=o(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|f(t.length);return 0===(e=o(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length,n!=n)?o(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=o(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|f(t.length);e=o(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return T(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return $(e).length;default:if(n)return T(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,i){var a,s=1,o=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,o/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(a=r;a<o;a++)if(u(e,a)===u(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===c)return l*s}else-1!==l&&(a-=a-l),l=-1}else for(r+c>o&&(r=o-c),a=r;a>=0;a--){for(var h=!0,d=0;d<c;d++)if(u(e,a+d)!==u(t,d)){h=!1;break}if(h)return a}return-1}function y(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(t.substr(2*s,2),16);if(isNaN(o))return s;e[r+s]=o}return s}function P(e,t,r,n){return F(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function _(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,s,o,c,u=e[i],l=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(l=u);break;case 2:128==(192&(a=e[i+1]))&&(c=(31&u)<<6|63&a)>127&&(l=c);break;case 3:a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&(c=(15&u)<<12|(63&a)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(c=(15&u)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&c<1114112&&(l=c)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return u(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return n=null,a=t,s=r,l(i=e),i<=0?o(n,i):void 0!==a?"string"==typeof s?o(n,i).fill(a,s):o(n,i).fill(a):o(n,i);var n,i,a,s},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?_(this,0,e):function(e,t,r){var i,a,s,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return b(this,t,r);case"utf8":case"utf-8":return _(this,t,r);case"ascii":return w(this,t,r);case"latin1":case"binary":return E(this,t,r);case"base64":return i=this,s=r,0===(a=t)&&s===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(a,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,r);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var a=i-n,s=r-t,o=Math.min(a,s),u=this.slice(n,i),l=e.slice(t,r),h=0;h<o;++h)if(u[h]!==l[h]){a=u[h],s=l[h];break}return a<s?-1:s<a?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a,s,o,c,u,l,h,d,f,p=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return d=t,f=r,F(T(e,(h=this).length-d),h,d,f);case"ascii":return P(this,e,t,r);case"latin1":case"binary":return P(this,e,t,r);case"base64":return c=this,u=t,l=r,F($(e),c,u,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=t,o=r,F(function(e,t){for(var r,n,i,a=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(e,(a=this).length-s),a,s,o);default:if(p)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),p=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function w(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function E(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function b(e,t,r){var n,i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var a="",s=t;s<r;++s)a+=(n=e[s],n<16?"0"+n.toString(16):n.toString(16));return a}function x(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function I(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,i,a){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function D(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function L(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function M(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function R(e,t,r,n,a){return a||M(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function O(e,t,r,n,a){return a||M(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;r=new c(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var a=0,s=1,o=0;for(this[t]=255&e;++a<r&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var a=r-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return R(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return R(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return O(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return O(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=c.isBuffer(e)?e:T(new c(e,n).toString()),o=s.length;for(a=0;a<r-t;++a)this[a+t]=s[a%o]}return this};var A=/[^+\/0-9A-Za-z-_]/g;function T(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function $(e){return n.toByteArray(function(e){if((e=(t=e,t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(A,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(11))},function(e,t,r){"use strict";(function(e){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),a=r(3),s=r(0);class o extends a.ButtplugBluetoothDevice{constructor(t){super(`Lovense ${t.Name}`,t),this.HandleVibrateCmd=(e=>n(this,void 0,void 0,function*(){return 1!==e.Speeds.length?new s.Error("Lovense devices require VibrateCmd to have 1 speed command, "+`${e.Speeds.length} sent.`,s.ErrorClass.ERROR_DEVICE,e.Id):yield this.HandleSingleMotorVibrateCmd(new s.SingleMotorVibrateCmd(e.Speeds[0].Speed,e.DeviceIndex,e.Id))})),this.HandleStopDeviceCmd=(e=>n(this,void 0,void 0,function*(){return yield this.HandleSingleMotorVibrateCmd(new s.SingleMotorVibrateCmd(0,e.DeviceIndex,e.Id))})),this.HandleSingleMotorVibrateCmd=(t=>n(this,void 0,void 0,function*(){const r=Math.floor(20*t.Speed);return yield this._deviceImpl.WriteValue("tx",e.from("Vibrate:"+r+";")),new s.Ok(t.Id)})),this.MsgFuncs.set(s.StopDeviceCmd.name,this.HandleStopDeviceCmd),this.MsgFuncs.set(s.VibrateCmd.name,this.HandleVibrateCmd),this.MsgFuncs.set(s.SingleMotorVibrateCmd.name,this.HandleSingleMotorVibrateCmd)}static CreateInstance(e){return Promise.resolve(new o(e))}get MessageSpecifications(){return{VibrateCmd:{FeatureCount:1},SingleMotorVibrateCmd:{},StopDeviceCmd:{}}}}o._deviceNames={"LVS-A011":"Nora","LVS-C011":"Nora","LVS-B011":"Max","LVS-L009":"Ambi","LVS-S001":"Lush","LVS-S35":"Lush","LVS-Z36":"Hush","LVS-Z001":"Hush",LVS_Z001:"Hush","LVS-Hush41":"Hush","LVS-Domi37":"Domi","LVS-Domi38":"Domi","LVS-Domi39":"Domi","LVS-Domi40":"Domi","LVS-P36":"Edge","LVS-Edge37":"Edge","LVS-Edge38":"Edge","LVS-Edge39":"Edge","LVS-Edge40":"Edge","LVS-Lush41":"Lush"},t.Lovense=o;class c{}c.DeviceInfo=new i.BluetoothDeviceInfo(["LVS-A011","LVS-C011","LVS-B011","LVS-L009"],["0000fff0-0000-1000-8000-00805f9b34fb"],{tx:"0000fff2-0000-1000-8000-00805f9b34fb"},o.CreateInstance),t.LovenseRev1=c;class u{}u.DeviceInfo=new i.BluetoothDeviceInfo(["LVS-S001","LVS-Z001","LVS_Z001"],["6e400001-b5a3-f393-e0a9-e50e24dcca9e"],{tx:"6e400002-b5a3-f393-e0a9-e50e24dcca9e"},o.CreateInstance),t.LovenseRev2=u;class l{}l.DeviceInfo=new i.BluetoothDeviceInfo(["LVS-P36"],["50300001-0024-4bd4-bbd5-a6920e4c5653"],{tx:"50300002-0024-4bd4-bbd5-a6920e4c5653"},o.CreateInstance),t.LovenseRev3=l;class h{}h.DeviceInfo=new i.BluetoothDeviceInfo(["LVS-Domi37","LVS-Domi38","LVS-Domi39","LVS-Domi40"],["57300001-0023-4bd4-bbd5-a6920e4c5653"],{tx:"57300002-0023-4bd4-bbd5-a6920e4c5653"},o.CreateInstance),t.LovenseRev4=h;class d{}d.DeviceInfo=new i.BluetoothDeviceInfo(["LVS-Z36"],["5a300001-0024-4bd4-bbd5-a6920e4c5653"],{tx:"5a300002-0024-4bd4-bbd5-a6920e4c5653"},o.CreateInstance),t.LovenseRev5=d;class f{}f.DeviceInfo=new i.BluetoothDeviceInfo(["LVS-Edge37","LVS-Edge38","LVS-Edge39","LVS-Edge40"],["50300001-0023-4bd4-bbd5-a6920e4c5653"],{tx:"50300002-0023-4bd4-bbd5-a6920e4c5653"},o.CreateInstance),t.LovenseRev6=f;class p{}p.DeviceInfo=new i.BluetoothDeviceInfo(["LVS-S35"],["53300001-0023-4bd4-bbd5-a6920e4c5653"],{tx:"53300002-0023-4bd4-bbd5-a6920e4c5653"},o.CreateInstance),t.LovenseRev7=p;class m{}m.DeviceInfo=new i.BluetoothDeviceInfo(["LVS-Hush41"],["5a300001-0023-4bd4-bbd5-a6920e4c5653"],{tx:"5a300002-0023-4bd4-bbd5-a6920e4c5653"},o.CreateInstance),t.LovenseRev8=m}).call(this,r(40).Buffer)},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),a=r(3),s=r(0);class o extends a.ButtplugBluetoothDevice{constructor(e){super("Fleshlight Launch",e),this._lastPosition=0,this.HandleStopDeviceCmd=(e=>n(this,void 0,void 0,function*(){return yield this.HandleFleshlightLaunchFW12Cmd(new s.FleshlightLaunchFW12Cmd(0,0,e.DeviceIndex,e.Id))})),this.HandleFleshlightLaunchFW12Cmd=(e=>n(this,void 0,void 0,function*(){return this._lastPosition=e.Position,yield this._deviceImpl.WriteValue("tx",new Uint8Array([e.Position,e.Speed])),new s.Ok(e.Id)})),this.HandleLinearCmd=(e=>n(this,void 0,void 0,function*(){if(1!==e.Vectors.length)return new s.Error("LinearCmd requires 1 vector for this device.",s.ErrorClass.ERROR_DEVICE,e.Id);const t=e.Vectors[0],r=100*t.Position,n=Math.abs(r-this._lastPosition);let i=Math.floor(25e3*Math.pow(90*t.Duration/n,-1.05));i=Math.min(Math.max(i,0),95);const a=Math.floor(r/99*90+4.5);return yield this.HandleFleshlightLaunchFW12Cmd(new s.FleshlightLaunchFW12Cmd(i,a,e.DeviceIndex,e.Id))})),this.MsgFuncs.set(s.StopDeviceCmd.name,this.HandleStopDeviceCmd),this.MsgFuncs.set(s.FleshlightLaunchFW12Cmd.name,this.HandleFleshlightLaunchFW12Cmd),this.MsgFuncs.set(s.LinearCmd.name,this.HandleLinearCmd)}static CreateInstance(e){return n(this,void 0,void 0,function*(){return yield e.WriteValue("cmd",new Uint8Array([0])),new o(e)})}get MessageSpecifications(){return{FleshlightLaunchFW12Cmd:{},StopDeviceCmd:{},LinearCmd:{FeatureCount:1}}}}o.DeviceInfo=new i.BluetoothDeviceInfo(["Launch"],["88f80580-0000-01e6-aace-0002a5d5c51b"],{cmd:"88f80583-0000-01e6-aace-0002a5d5c51b",tx:"88f80581-0000-01e6-aace-0002a5d5c51b"},o.CreateInstance),t.FleshlightLaunch=o},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(15),a=r(1),s=r(33);t.WebBluetoothDeviceManager=class extends a.EventEmitter{constructor(){super(...arguments),this.OpenDevice=(e=>n(this,void 0,void 0,function*(){if(void 0===e)return;const t=i.BluetoothDevices.GetDeviceInfo();let r=null;for(const n of t)if(n.Names.indexOf(e.name)>=0){r=n;break}if(null===r)return;const n=yield s.WebBluetoothDevice.CreateDevice(r,e);this.emit("deviceadded",n)}))}StartScanning(){return n(this,void 0,void 0,function*(){const e=i.BluetoothDevices.GetDeviceInfo(),t={filters:new Array,optionalServices:new Array};for(const r of e){for(const e of r.Names)t.filters.push({name:e});t.optionalServices=[...t.optionalServices,...r.Services]}let r;try{r=yield navigator.bluetooth.requestDevice(t)}catch(e){if(this.emit("scanningfinished"),-1!==e.message.indexOf("User cancelled"))return;throw new Error("Bluetooth scanning interrupted. Either user cancelled out of dialog, or bluetooth radio is not available. Exception: "+e)}try{yield this.OpenDevice(r)}catch(e){throw this.emit("scanningfinished"),new Error(`Cannot open device ${r.name}: ${e}`)}this.emit("scanningfinished")})}StopScanning(){}get IsScanning(){return!1}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),a=r(43),s=r(1),o=r(13),c=r(6);t.DeviceManager=class extends s.EventEmitter{constructor(){super(),this._subtypeManagers=[],this._devices=new Map,this._deviceCounter=0,this._logger=c.ButtplugLogger.Logger,this.Shutdown=(()=>n(this,void 0,void 0,function*(){for(const e of this._devices.values())yield e.Disconnect()})),this.ClearDeviceManagers=(()=>{this._logger.Info("DeviceManager: Clearing device subtype managers"),this._subtypeManagers=[]}),this.AddDeviceManager=(e=>{this._logger.Info(`DeviceManager: Adding Device Manager ${e.constructor.name}`),this._subtypeManagers.push(e),e.addListener("deviceadded",this.OnDeviceAdded),e.addListener("deviceremoved",this.OnDeviceRemoved),e.addListener("scanningfinished",this.OnScanningFinished)}),this.SendMessage=(e=>n(this,void 0,void 0,function*(){const t=e.Id;switch(e.Type){case"StartScanning":if(this._logger.Debug("DeviceManager: Starting scan"),0===this._subtypeManagers.length)return this._logger.LogAndError("No device managers available, cannot scan.",i.ErrorClass.ERROR_DEVICE,t);for(const e of this._subtypeManagers)if(!e.IsScanning)try{yield e.StartScanning()}catch(e){return this._logger.LogAndError(e.message,i.ErrorClass.ERROR_DEVICE,t)}return new i.Ok(t);case"StopScanning":this._logger.Debug("DeviceManager: Stopping scan");for(const e of this._subtypeManagers)e.IsScanning&&e.StopScanning();return new i.Ok(t);case"StopAllDevices":return this._logger.Debug("DeviceManager: Stopping all devices"),this._devices.forEach((e,t)=>{e.ParseMessage(new i.StopDeviceCmd)}),new i.Ok(t);case"RequestDeviceList":this._logger.Debug("DeviceManager: Sending device list");const r=[];return this._devices.forEach((e,t)=>{r.push(new i.DeviceInfo(t,e.Name,e.AllowedMessageTypes))}),new i.DeviceList(r,t)}const r=e;if(void 0===r.DeviceIndex)return this._logger.LogAndError(`Message Type ${e.Type} unhandled by this server.`,i.ErrorClass.ERROR_MSG,t);if(!this._devices.has(r.DeviceIndex))return this._logger.LogAndError(`Device Index ${r.DeviceIndex} does not exist`,i.ErrorClass.ERROR_DEVICE,t);const n=this._devices.get(r.DeviceIndex);return n.AllowedMessageTypes.indexOf(e.Type)<0?this._logger.LogAndError(`Device ${n.Name} does not take message type ${e.Type}`,i.ErrorClass.ERROR_DEVICE,t):(this._logger.Trace(`DeviceManager: Sending ${r.Type} to ${n.Name} (${r.Id})`),yield n.ParseMessage(r))})),this.OnDeviceAdded=(e=>{for(const t of this._devices.values())if(t.Id===e.Id)return void this._logger.Info(`DeviceManager: Device ${e.Name} (id: ${e.Id}) already added, ignoring.`);const t=this._deviceCounter;this._deviceCounter+=1,this._devices.set(t,e),this._logger.Info(`DeviceManager: Device Added: ${e.Name} (${t})`),e.addListener("deviceremoved",this.OnDeviceRemoved),o.ServerMessageHub.Instance.emitMessage(new i.DeviceAdded(t,e.Name,e.MessageSpecifications))}),this.OnDeviceRemoved=(e=>{let t=null;for(const r of Array.from(this._devices.entries()))if(r[1]===e){t=r[0];break}null!==t&&(e.removeAllListeners("deviceremoved"),this._devices.delete(t),this._logger.Info(`DeviceManager: Device Removed: ${e.Name} (${t})`),o.ServerMessageHub.Instance.emitMessage(new i.DeviceRemoved(t)))}),this.OnScanningFinished=(()=>{this._logger.Debug("DeviceManager: Scanning Finished.");for(const e of this._subtypeManagers)if(e.IsScanning)return;o.ServerMessageHub.Instance.emitMessage(new i.ScanningFinished)}),this._logger.Debug("DeviceManager: Starting Device Manager"),"undefined"!=typeof window&&void 0!==window.navigator&&navigator.bluetooth?this.AddDeviceManager(new a.WebBluetoothDeviceManager):this._logger.Info("DeviceManager: Not adding WebBluetooth Manager, no capabilities found.")}get DeviceManagers(){return this._subtypeManagers}}},function(e){e.exports={$schema:"http://json-schema.org/draft-06/schema#",$id:"http://json-schema.org/draft-06/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},title:{type:"string"},description:{type:"string"},default:{},examples:{type:"array",items:{}},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:{}},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:{},enum:{type:"array",minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:{}}},function(e){e.exports={$schema:"http://json-schema.org/draft-06/schema#",title:"Buttplug Message Schema",version:1,description:"The JSON Protocol format for the Buttplug Protocol.",components:{Id:{description:"User-set id for the message. 0 denotes system message and is reserved.",type:"integer",minimum:0,maximum:4294967295},SystemId:{description:"Used for non-direct-reply messages that can only be sent from server to client, using the reserved system message Id of 0.",type:"integer",minimum:0,maximum:0},DeviceName:{description:"Name of the device",type:"string"},DeviceIndex:{description:"Index used for referencing the device in device messages.",type:"integer",minimum:0},IdMessage:{properties:{Id:{$ref:"#/components/Id"}},additionalProperties:!1,minProperties:1,maxProperties:1,required:["Id"]},DeviceMessages:{description:"A list of the messages a device will accept on this server implementation.",type:"array",items:{type:"string",minItems:1}},DeviceMessagesEx:{description:"A list of the messages a device will accept on this server implementation.",type:"object",items:{description:"A list of the messages attributes.",type:"object",properties:{FeatureCount:{$ref:"#/components/FeatureCount"}},additionalProperties:!0,minItems:1}},SystemIdMessage:{description:"Message sent by the server that is not in direct reply to a message send from the client, and always uses system Id.",properties:{Id:{$ref:"#/components/SystemId"}},additionalProperties:!1,minProperties:1,maxProperties:1,required:["Id"]},DeviceIndexMessage:{properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"}},additionalProperties:!1,minProperties:2,maxProperties:2,required:["Id","DeviceIndex"]},FeatureCount:{description:"Number of features on device.",type:"integer",minimum:0}},messages:{Ok:{type:"object",description:"Signifies successful processing of the message indicated by the id.",anyOf:[{$ref:"#/components/IdMessage"}]},Ping:{type:"object",description:"Connection keep-alive message.",anyOf:[{$ref:"#/components/IdMessage"}]},Error:{type:"object",description:"Signifies the server encountered an error while processing the message indicated by the id.",properties:{Id:{$ref:"#/components/Id"},ErrorMessage:{type:"string"},ErrorCode:{type:"number",minimum:0,maximum:4}},additionalProperties:!1,minProperties:3,maxProperties:3,required:["Id","ErrorMessage","ErrorCode"]},Test:{type:"object",description:"Used for connection/application testing. Causes server to echo back the string sent. Sending string of 'Error' will result in a server error. ",properties:{Id:{$ref:"#/components/Id"},TestString:{description:"String to be echo'd back from server. Setting this to 'Error' will cause an error to be thrown.",type:"string"}},minProperties:2,maxProperties:2,additionalProperties:!1,required:["Id","TestString"]},DeviceList:{type:"object",description:"List of all available devices known to the system.",properties:{Id:{$ref:"#/components/Id"},Devices:{description:"Array of device ids and names.",type:"array",items:{properties:{DeviceName:{$ref:"#/components/DeviceName"},DeviceIndex:{$ref:"#/components/DeviceIndex"},DeviceMessages:{oneOf:[{$ref:"#/components/DeviceMessages"},{$ref:"#/components/DeviceMessagesEx"}]}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["DeviceName","DeviceIndex","DeviceMessages"]}}},minProperties:2,maxProperties:2,additionalProperties:!1,required:["Id","Devices"]},DeviceAdded:{type:"object",description:"Notifies client that a device of a certain type has been added to the server.",properties:{Id:{$ref:"#/components/SystemId"},DeviceName:{$ref:"#/components/DeviceName"},DeviceIndex:{$ref:"#/components/DeviceIndex"},DeviceMessages:{oneOf:[{$ref:"#/components/DeviceMessages"},{$ref:"#/components/DeviceMessagesEx"}]}},minProperties:4,maxProperties:4,additionalProperties:!1,required:["Id","DeviceName","DeviceIndex","DeviceMessages"]},DeviceRemoved:{type:"object",description:"Notifies client that a device of a certain type has been removed from the server.",anyOf:[{$ref:"#/components/DeviceIndexMessage"}]},RequestDeviceList:{type:"object",description:"Request for the server to send a list of devices to the client.",anyOf:[{$ref:"#/components/IdMessage"}]},StartScanning:{type:"object",description:"Request for the server to start scanning for new devices.",anyOf:[{$ref:"#/components/IdMessage"}]},StopScanning:{type:"object",description:"Request for the server to stop scanning for new devices.",anyOf:[{$ref:"#/components/IdMessage"}]},ScanningFinished:{type:"object",description:"Server notification to client that scanning has ended.",anyOf:[{$ref:"#/components/SystemIdMessage"}]},RequestLog:{type:"object",description:"Request for server to stream log messages of a certain level to client.",properties:{Id:{$ref:"#/components/Id"},LogLevel:{description:"Maximum level of log message to receive.",enum:["Off","Fatal","Error","Warn","Info","Debug","Trace"]}},minProperties:2,maxProperties:2,additionalProperties:!1,required:["Id","LogLevel"]},Log:{type:"object",description:"Log message from the server.",properties:{Id:{$ref:"#/components/SystemId"},LogLevel:{description:"Log level of message.",enum:["Off","Fatal","Error","Warn","Info","Debug","Trace"]},LogMessage:{description:"Log message from server.",type:"string"}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Id","LogLevel","LogMessage"]},RequestServerInfo:{type:"object",description:"Request server version, and relay client name.",properties:{Id:{$ref:"#/components/Id"},ClientName:{description:"Name of the client software.",type:"string"},MessageVersion:{description:"Message template version of the client software.",type:"integer",minimum:0}},minProperties:2,maxProperties:3,additionalProperties:!1,required:["Id","ClientName"]},ServerInfo:{type:"object",description:"Server version information, in Major.Minor.Build format.",properties:{Id:{$ref:"#/components/Id"},ServerName:{description:"Name of the server. Can be 0-length.",type:"string"},MessageVersion:{description:"Message template version of the server software.",type:"integer",minimum:0},MajorVersion:{description:"Major version of server.",type:"integer",minimum:0},MinorVersion:{description:"Minor version of server.",type:"integer",minimum:0},BuildVersion:{description:"Build version of server.",type:"integer",minimum:0},MaxPingTime:{description:"Maximum time (in milliseconds) the server will wait between ping messages from client before shutting down.",type:"integer",minimum:0}},minProperties:7,maxProperties:7,additionalProperties:!1,required:["Id","MajorVersion","MinorVersion","BuildVersion","MessageVersion","MaxPingTime","ServerName"]},FleshlightLaunchFW12Cmd:{type:"object",description:"Sends speed and position command to the Fleshlight Launch Device denoted by the device index.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Speed:{description:"Speed at which to move to designated position.",type:"integer",minimum:0,maximum:99},Position:{description:"Position to which to move Fleshlight.",type:"integer",minimum:0,maximum:99}},minProperties:4,maxProperties:4,additionalProperties:!1,required:["Id","DeviceIndex","Speed","Position"]},LovenseCmd:{type:"object",description:"Sends a command string to a Lovense device. Command string will be verified by sender.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Command:{description:"Command to send to Lovense device.",type:"string"}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Id","DeviceIndex","Command"]},SingleMotorVibrateCmd:{type:"object",description:"Sends a vibrate command to a device that supports vibration.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Speed:{description:"Device vibration speed (floating point, 0 < x < 1), stepping will be device specific.",type:"number",minimum:0,maximum:1}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Id","DeviceIndex","Speed"]},RawCmd:{type:"object",description:"Sends a raw byte array to a device. Should only be used for testing/development.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Command:{description:"Raw byte string to send to device.",type:"array",items:{type:"integer",minimum:0,maximum:255,minItems:1}}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Id","DeviceIndex","Command"]},KiirooCmd:{type:"object",description:"Sends a raw byte string to a Kiiroo Onyx/Pearl device.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Command:{description:"Command to send to Kiiroo device.",type:"string"}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Id","DeviceIndex","Command"]},VorzeA10CycloneCmd:{type:"object",description:"Sends a raw byte string to a Kiiroo Onyx/Pearl device.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Speed:{description:"Rotation speed command for the Cyclone.",type:"integer",minimum:0,maximum:100},Clockwise:{description:"True for clockwise rotation (in relation to device facing user), false for Counter-clockwise",type:"boolean"}},minProperties:4,maxProperties:4,additionalProperties:!1,required:["Id","DeviceIndex","Speed","Clockwise"]},StopDeviceCmd:{type:"object",description:"Stops the all actions currently being taken by a device.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"}},minProperties:2,maxProperties:2,additionalProperties:!1,required:["Id","DeviceIndex"]},StopAllDevices:{type:"object",description:"Stops all actions currently being taken by all connected devices.",anyOf:[{$ref:"#/components/IdMessage"}]},VibrateCmd:{type:"object",description:"Sends a vibrate command to a device that supports vibration.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Speeds:{description:"Device vibration speeds (floating point, 0 < x < 1) keyed on vibrator number, stepping will be device specific.",type:"array",items:{Index:{description:"Vibrator number.",type:"integer",minimum:0},Speed:{description:"Vibration speed (floating point, 0 < x < 1), stepping will be device specific.",type:"number",minimum:0,maximum:1}},minProperties:2,maxProperties:2,additionalProperties:!1,required:["Index","Speed"]}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Id","DeviceIndex","Speeds"]},RotateCmd:{type:"object",description:"Sends a rotate command to a device that supports rotation.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Rotations:{description:"Device rotation speeds (floating point, 0 < x < 1) keyed on rotator number, stepping will be device specific.",type:"array",items:{Index:{description:"Rotator number.",type:"integer",minimum:0},Speed:{description:"Rotation speed (floating point, 0 < x < 1), stepping will be device specific.",type:"number",minimum:0,maximum:1},Clockwise:{description:"Rotation direction (boolean). Not all devices have a concept of actual clockwise.",type:"boolean"}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Index","Speed","Clockwise"]}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Id","DeviceIndex","Rotations"]},LinearCmd:{type:"object",description:"Sends a linear movement command to a device that supports linear movements.",properties:{Id:{$ref:"#/components/Id"},DeviceIndex:{$ref:"#/components/DeviceIndex"},Vectors:{description:"Device linear movement times (milliseconds) and positions (floating point, 0 < x < 1) keyed on linear actuator number, stepping will be device specific.",type:"array",items:{Index:{description:"Linear actuator number.",type:"integer",minimum:0},Duration:{description:"Linear movement time in milliseconds.",type:"number",minimum:0},Position:{description:"Linear movement position (floating point, 0 < x < 1), stepping will be device specific.",type:"number",minimum:0,maximum:1}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Index","Speed","Position"]}},minProperties:3,maxProperties:3,additionalProperties:!1,required:["Id","DeviceIndex","Vectors"]}},type:"array",items:{title:"Messages",description:"One or more messages validated by the Buttplug Message schema list.",properties:{Ok:{$ref:"#/messages/Ok"},Error:{$ref:"#/messages/Error"},Ping:{$ref:"#/messages/Ping"},Test:{$ref:"#/messages/Test"},DeviceList:{$ref:"#/messages/DeviceList"},DeviceAdded:{$ref:"#/messages/DeviceAdded"},DeviceRemoved:{$ref:"#/messages/DeviceRemoved"},RequestDeviceList:{$ref:"#/messages/RequestDeviceList"},StopDeviceCmd:{$ref:"#/messages/StopDeviceCmd"},StopAllDevices:{$ref:"#/messages/StopAllDevices"},StartScanning:{$ref:"#/messages/StartScanning"},StopScanning:{$ref:"#/messages/StopScanning"},ScanningFinished:{$ref:"#/messages/ScanningFinished"},RequestLog:{$ref:"#/messages/RequestLog"},Log:{$ref:"#/messages/Log"},RequestServerInfo:{$ref:"#/messages/RequestServerInfo"},ServerInfo:{$ref:"#/messages/ServerInfo"},FleshlightLaunchFW12Cmd:{$ref:"#/messages/FleshlightLaunchFW12Cmd"},LovenseCmd:{$ref:"#/messages/LovenseCmd"},SingleMotorVibrateCmd:{$ref:"#/messages/SingleMotorVibrateCmd"},KiirooCmd:{$ref:"#/messages/KiirooCmd"},RawCmd:{$ref:"#/messages/RawCmd"},VorzeA10CycloneCmd:{$ref:"#/messages/VorzeA10CycloneCmd"},VibrateCmd:{$ref:"#/messages/VibrateCmd"},RotateCmd:{$ref:"#/messages/RotateCmd"},LinearCmd:{$ref:"#/messages/LinearCmd"}},additionalProperties:!1,minProperties:1,maxProperties:1},minItems:1,additionalProperties:!1}},function(e){e.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}},function(e){e.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i,a=" ",s=e.level,o=e.dataLevel,c=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,h=!e.opts.allErrors,d="data"+(o||""),f="valid"+s,p="errs__"+s,m=e.opts.$data&&c&&c.$data;m?(a+=" var schema"+s+" = "+e.util.getData(c.$data,o,e.dataPathArr)+"; ",i="schema"+s):i=c;var v,g,y,P,_,S="definition"+s,w=this.definition,E="";if(m&&w.$data){_="keywordValidate"+s;var b=w.validateSchema;a+=" var "+S+" = RULES.custom['"+t+"'].definition; var "+_+" = "+S+".validate;"}else{if(!(P=e.useCustomRule(this,c,e.schema,e)))return;i="validate.schema"+u,_=P.code,v=w.compile,g=w.inline,y=w.macro}var x=_+".errors",I="i"+s,C="ruleErr"+s,D=w.async;if(D&&!e.async)throw new Error("async keyword in sync schema");if(g||y||(a+=x+" = null;"),a+="var "+p+" = errors;var "+f+";",m&&w.$data&&(E+="}",a+=" if ("+i+" === undefined) { "+f+" = true; } else { ",b&&(E+="}",a+=" "+f+" = "+S+".validateSchema("+i+"); if ("+f+") { ")),g)w.statements?a+=" "+P.validate+" ":a+=" "+f+" = "+P.validate+"; ";else if(y){var L=e.util.copy(e);E="",L.level++;var M="valid"+L.level;L.schema=P.validate,L.schemaPath="";var R=e.compositeRule;e.compositeRule=L.compositeRule=!0;var O=e.validate(L).replace(/validate\.schema/g,_);e.compositeRule=L.compositeRule=R,a+=" "+O}else{(F=F||[]).push(a),a="",a+="  "+_+".call( ",e.opts.passContext?a+="this":a+="self",v||!1===w.schema?a+=" , "+d+" ":a+=" , "+i+" , "+d+" , validate.schema"+e.schemaPath+" ",a+=" , (dataPath || '')",'""'!=e.errorPath&&(a+=" + "+e.errorPath);var A=o?"data"+(o-1||""):"parentData",T=o?e.dataPathArr[o]:"parentDataProperty",$=a+=" , "+A+" , "+T+" , rootData )  ";a=F.pop(),!1===w.errors?(a+=" "+f+" = ",D&&(a+="await "),a+=$+"; "):a+=D?" var "+(x="customErrors"+s)+" = null; try { "+f+" = await "+$+"; } catch (e) { "+f+" = false; if (e instanceof ValidationError) "+x+" = e.errors; else throw e; } ":" "+x+" = null; "+f+" = "+$+"; "}if(w.modifying&&(a+=" if ("+A+") "+d+" = "+A+"["+T+"];"),a+=""+E,w.valid)h&&(a+=" if (true) { ");else{var F;a+=" if ( ",void 0===w.valid?(a+=" !",a+=y?""+M:""+f):a+=" "+!w.valid+" ",a+=") { ",n=this.keyword,(F=F||[]).push(a),a="",(F=F||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(a+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(a+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),a+=" } "):a+=" {} ";var j=a;a=F.pop(),!e.compositeRule&&h?e.async?a+=" throw new ValidationError(["+j+"]); ":a+=" validate.errors = ["+j+"]; return false; ":a+=" var err = "+j+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var V=a;a=F.pop(),g?w.errors?"full"!=w.errors&&(a+="  for (var "+I+"="+p+"; "+I+"<errors; "+I+"++) { var "+C+" = vErrors["+I+"]; if ("+C+".dataPath === undefined) "+C+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+C+".schemaPath === undefined) { "+C+'.schemaPath = "'+l+'"; } ',e.opts.verbose&&(a+=" "+C+".schema = "+i+"; "+C+".data = "+d+"; "),a+=" } "):!1===w.errors?a+=" "+V+" ":(a+=" if ("+p+" == errors) { "+V+" } else {  for (var "+I+"="+p+"; "+I+"<errors; "+I+"++) { var "+C+" = vErrors["+I+"]; if ("+C+".dataPath === undefined) "+C+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+C+".schemaPath === undefined) { "+C+'.schemaPath = "'+l+'"; } ',e.opts.verbose&&(a+=" "+C+".schema = "+i+"; "+C+".data = "+d+"; "),a+=" } } "):y?(a+="   var err =   ",!1!==e.createErrors?(a+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(a+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(a+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),a+=" } "):a+=" {} ",a+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&h&&(e.async?a+=" throw new ValidationError(vErrors); ":a+=" validate.errors = vErrors; return false; ")):!1===w.errors?a+=" "+V+" ":(a+=" if (Array.isArray("+x+")) { if (vErrors === null) vErrors = "+x+"; else vErrors = vErrors.concat("+x+"); errors = vErrors.length;  for (var "+I+"="+p+"; "+I+"<errors; "+I+"++) { var "+C+" = vErrors["+I+"]; if ("+C+".dataPath === undefined) "+C+".dataPath = (dataPath || '') + "+e.errorPath+";  "+C+'.schemaPath = "'+l+'";  ',e.opts.verbose&&(a+=" "+C+".schema = "+i+"; "+C+".data = "+d+"; "),a+=" } } else { "+V+" } "),a+=" } ",h&&(a+=" else { ")}return a}},function(e,t,r){"use strict";var n=/^[a-z_$][a-z0-9_$-]*$/i,i=r(49);e.exports={add:function(e,t){var r=this.RULES;if(r.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!n.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){if(t.macro&&void 0!==t.valid)throw new Error('"valid" option cannot be used with macro keywords');var a=t.type;if(Array.isArray(a)){var s,o=a.length;for(s=0;s<o;s++)h(a[s]);for(s=0;s<o;s++)l(e,a[s],t)}else a&&h(a),l(e,a,t);var c=!0===t.$data&&this._opts.$data;if(c&&!t.validate)throw new Error('$data support: "validate" function is not defined');var u=t.metaSchema;u&&(c&&(u={anyOf:[u,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]}),t.validateSchema=this.compile(u,!0))}function l(e,t,n){for(var a,s=0;s<r.length;s++){var o=r[s];if(o.type==t){a=o;break}}a||(a={type:t,rules:[]},r.push(a));var c={keyword:e,definition:n,custom:!0,code:i,implements:n.implements};a.rules.push(c),r.custom[e]=c}function h(e){if(!r.types[e])throw new Error("Unknown type "+e)}return r.keywords[e]=r.all[e]=!0,this},get:function(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1},remove:function(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var n=t[r].rules,i=0;i<n.length;i++)if(n[i].keyword==e){n.splice(i,1);break}return this}}},function(e,t,r){"use strict";var n=r(8).MissingRef;e.exports=function e(t,r,i){var a=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof r&&(i=r,r=void 0);var s=o(t).then(function(){var e=a._addSchema(t,void 0,r);return e.validate||function(e){try{return a._compile(e)}catch(t){if(t instanceof n)return function(t){var i=t.missingSchema;if(u(i))throw new Error("Schema "+i+" is loaded but "+t.missingRef+" cannot be resolved");var s=a._loadingSchemas[i];return s||(s=a._loadingSchemas[i]=a._opts.loadSchema(i)).then(c,c),s.then(function(e){if(!u(i))return o(e).then(function(){u(i)||a.addSchema(e,i,void 0,r)})}).then(function(){return function e(t){try{return a._compile(t)}catch(t){if(t instanceof n)return function(n){var i=n.missingSchema;if(u(i))throw new Error("Schema "+i+" is loaded but "+n.missingRef+" cannot be resolved");var s=a._loadingSchemas[i];return s||(s=a._loadingSchemas[i]=a._opts.loadSchema(i)).then(c,c),s.then(function(e){if(!u(i))return o(e).then(function(){u(i)||a.addSchema(e,i,void 0,r)})}).then(function(){return e(t)});function c(){delete a._loadingSchemas[i]}function u(e){return a._refs[e]||a._schemas[e]}}(t);throw t}}(e)});function c(){delete a._loadingSchemas[i]}function u(e){return a._refs[e]||a._schemas[e]}}(t);throw t}}(e)});return i&&s.then(function(e){i(null,e)},i),s;function o(t){var r=t.$schema;return r&&!a.getSchema(r)?e.call(a,{$ref:r},!0):Promise.resolve()}}},function(e,t,r){"use strict";var n=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];e.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var i,a=t[r].split("/"),s=e;for(i=1;i<a.length;i++)s=s[a[i]];for(i=0;i<n.length;i++){var o=n[i],c=s[o];c&&(s[o]={anyOf:[c,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]})}}return e}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],c=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,h="data"+(s||""),d="valid"+a,f=e.opts.$data&&o&&o.$data;if(f?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",n="schema"+a):n=o,(o||f)&&!1!==e.opts.uniqueItems){f&&(i+=" var "+d+"; if ("+n+" === false || "+n+" === undefined) "+d+" = true; else if (typeof "+n+" != 'boolean') "+d+" = false; else { "),i+=" var i = "+h+".length , "+d+" = true , j; if (i > 1) { ";var p=e.schema.items&&e.schema.items.type,m=Array.isArray(p);if(!p||"object"==p||"array"==p||m&&(p.indexOf("object")>=0||p.indexOf("array")>=0))i+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+h+"[i], "+h+"[j])) { "+d+" = false; break outer; } } } ";else{i+=" var itemIndices = {}, item; for (;i--;) { var item = "+h+"[i]; ";var v="checkDataType"+(m?"s":"");i+=" if ("+e.util[v](p,"item",!0)+") continue; ",m&&(i+=" if (typeof item == 'string') item = '\"' + item; "),i+=" if (typeof itemIndices[item] == 'number') { "+d+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}i+=" } ",f&&(i+="  }  "),i+=" if (!"+d+") {   ";var g=g||[];g.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",i+=f?"validate.schema"+c:""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var y=i;i=g.pop(),!e.compositeRule&&l?e.async?i+=" throw new ValidationError(["+y+"]); ":i+=" validate.errors = ["+y+"]; return false; ":i+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",l&&(i+=" else { ")}else l&&(i+=" if (true) { ");return i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="valid"+i,d=e.opts.$data&&s&&s.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ");var f="schema"+i;if(!d)if(s.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var p=[],m=s;if(m)for(var v,g=-1,y=m.length-1;g<y;){v=m[g+=1];var P=e.schema.properties[v];P&&e.util.schemaHasRules(P,e.RULES.all)||(p[p.length]=v)}}else p=s;if(d||p.length){var _=e.errorPath,S=d||p.length>=e.opts.loopRequired,w=e.opts.ownProperties;if(u)if(n+=" var missing"+i+"; ",S){d||(n+=" var "+f+" = validate.schema"+o+"; ");var E="' + "+(L="schema"+i+"["+(C="i"+i)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(_,L,e.opts.jsonPointers)),n+=" var "+h+" = true; ",d&&(n+=" if (schema"+i+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+i+")) "+h+" = false; else {"),n+=" for (var "+C+" = 0; "+C+" < "+f+".length; "+C+"++) { "+h+" = "+l+"["+f+"["+C+"]] !== undefined ",w&&(n+=" &&   Object.prototype.hasOwnProperty.call("+l+", "+f+"["+C+"]) "),n+="; if (!"+h+") break; } ",d&&(n+="  }  "),n+="  if (!"+h+") {   ",(x=x||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+E+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var b=n;n=x.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+b+"]); ":n+=" validate.errors = ["+b+"]; return false; ":n+=" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { "}else{n+=" if ( ";var x,I=p;if(I)for(var C=-1,D=I.length-1;C<D;)R=I[C+=1],C&&(n+=" || "),n+=" ( ( "+($=l+(T=e.util.getProperty(R)))+" === undefined ",w&&(n+=" || ! Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(R)+"') "),n+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?R:T)+") ) ";n+=") {  ",E="' + "+(L="missing"+i)+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(_,L,!0):_+" + "+L),(x=x||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+E+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",b=n,n=x.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+b+"]); ":n+=" validate.errors = ["+b+"]; return false; ":n+=" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { "}else if(S){var L;d||(n+=" var "+f+" = validate.schema"+o+"; "),E="' + "+(L="schema"+i+"["+(C="i"+i)+"]")+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(_,L,e.opts.jsonPointers)),d&&(n+=" if ("+f+" && !Array.isArray("+f+")) {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+E+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+f+" !== undefined) { "),n+=" for (var "+C+" = 0; "+C+" < "+f+".length; "+C+"++) { if ("+l+"["+f+"["+C+"]] === undefined ",w&&(n+=" || ! Object.prototype.hasOwnProperty.call("+l+", "+f+"["+C+"]) "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+E+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",d&&(n+="  }  ")}else{var M=p;if(M)for(var R,O=-1,A=M.length-1;O<A;){R=M[O+=1];var T=e.util.getProperty(R),$=(E=e.util.escapeQuotes(R),l+T);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(_,R,e.opts.jsonPointers)),n+=" if ( "+$+" === undefined ",w&&(n+=" || ! Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(R)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+E+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=_}else u&&(n+=" if (true) {");return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="errs__"+i,d=e.util.copy(e);d.level++;var f="valid"+d.level;if(e.util.schemaHasRules(s,e.RULES.all)){d.schema=s,d.schemaPath=o,d.errSchemaPath=c;var p="key"+i,m="idx"+i,v="i"+i,g="' + "+p+" + '",y="data"+(d.dataLevel=e.dataLevel+1),P="dataProperties"+i,_=e.opts.ownProperties,S=e.baseId;n+=" var "+h+" = errors; ",_&&(n+=" var "+P+" = undefined; "),n+=_?" "+P+" = "+P+" || Object.keys("+l+"); for (var "+m+"=0; "+m+"<"+P+".length; "+m+"++) { var "+p+" = "+P+"["+m+"]; ":" for (var "+p+" in "+l+") { ",n+=" var startErrs"+i+" = errors; ";var w=p,E=e.compositeRule;e.compositeRule=d.compositeRule=!0;var b=e.validate(d);d.baseId=S,e.util.varOccurences(b,y)<2?n+=" "+e.util.varReplace(b,y,w)+" ":n+=" var "+y+" = "+w+"; "+b+" ",e.compositeRule=d.compositeRule=E,n+=" if (!"+f+") { for (var "+v+"=startErrs"+i+"; "+v+"<errors; "+v+"++) { vErrors["+v+"].propertyName = "+p+"; }   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { propertyName: '"+g+"' } ",!1!==e.opts.messages&&(n+=" , message: 'property name \\'"+g+"\\' is invalid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),u&&(n+=" break; "),n+=" } }"}return u&&(n+="  if ("+h+" == errors) {"),e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="errs__"+i,d=e.util.copy(e),f="";d.level++;var p="valid"+d.level,m="key"+i,v="idx"+i,g=d.dataLevel=e.dataLevel+1,y="data"+g,P="dataProperties"+i,_=Object.keys(s||{}),S=e.schema.patternProperties||{},w=Object.keys(S),E=e.schema.additionalProperties,b=_.length||w.length,x=!1===E,I="object"==typeof E&&Object.keys(E).length,C=e.opts.removeAdditional,D=x||I||C,L=e.opts.ownProperties,M=e.baseId,R=e.schema.required;if(R&&(!e.opts.$data||!R.$data)&&R.length<e.opts.loopRequired)var O=e.util.toHash(R);if(n+="var "+h+" = errors;var "+p+" = true;",L&&(n+=" var "+P+" = undefined;"),D){if(n+=L?" "+P+" = "+P+" || Object.keys("+l+"); for (var "+v+"=0; "+v+"<"+P+".length; "+v+"++) { var "+m+" = "+P+"["+v+"]; ":" for (var "+m+" in "+l+") { ",b){if(n+=" var isAdditional"+i+" = !(false ",_.length)if(_.length>8)n+=" || validate.schema"+o+".hasOwnProperty("+m+") ";else{var A=_;if(A)for(var T=-1,$=A.length-1;T<$;)Y=A[T+=1],n+=" || "+m+" == "+e.util.toQuotedString(Y)+" "}if(w.length){var F=w;if(F)for(var j=-1,V=F.length-1;j<V;)ie=F[j+=1],n+=" || "+e.usePattern(ie)+".test("+m+") "}n+=" ); if (isAdditional"+i+") { "}if("all"==C)n+=" delete "+l+"["+m+"]; ";else{var k=e.errorPath,N="' + "+m+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers)),x)if(C)n+=" delete "+l+"["+m+"]; ";else{n+=" "+p+" = false; ";var B=c;c=e.errSchemaPath+"/additionalProperties",(te=te||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { additionalProperty: '"+N+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is an invalid additional property":n+="should NOT have additional properties",n+="' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var U=n;n=te.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+U+"]); ":n+=" validate.errors = ["+U+"]; return false; ":n+=" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=B,u&&(n+=" break; ")}else if(I)if("failing"==C){n+=" var "+h+" = errors;  ";var q=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.schema=E,d.schemaPath=e.schemaPath+".additionalProperties",d.errSchemaPath=e.errSchemaPath+"/additionalProperties",d.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var z=l+"["+m+"]";d.dataPathArr[g]=m;var H=e.validate(d);d.baseId=M,e.util.varOccurences(H,y)<2?n+=" "+e.util.varReplace(H,y,z)+" ":n+=" var "+y+" = "+z+"; "+H+" ",n+=" if (!"+p+") { errors = "+h+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+l+"["+m+"]; }  ",e.compositeRule=d.compositeRule=q}else d.schema=E,d.schemaPath=e.schemaPath+".additionalProperties",d.errSchemaPath=e.errSchemaPath+"/additionalProperties",d.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers),z=l+"["+m+"]",d.dataPathArr[g]=m,H=e.validate(d),d.baseId=M,e.util.varOccurences(H,y)<2?n+=" "+e.util.varReplace(H,y,z)+" ":n+=" var "+y+" = "+z+"; "+H+" ",u&&(n+=" if (!"+p+") break; ");e.errorPath=k}b&&(n+=" } "),n+=" }  ",u&&(n+=" if ("+p+") { ",f+="}")}var Q=e.opts.useDefaults&&!e.compositeRule;if(_.length){var W=_;if(W)for(var Y,K=-1,J=W.length-1;K<J;){var G=s[Y=W[K+=1]];if(e.util.schemaHasRules(G,e.RULES.all)){var Z=e.util.getProperty(Y),X=(z=l+Z,Q&&void 0!==G.default);if(d.schema=G,d.schemaPath=o+Z,d.errSchemaPath=c+"/"+e.util.escapeFragment(Y),d.errorPath=e.util.getPath(e.errorPath,Y,e.opts.jsonPointers),d.dataPathArr[g]=e.util.toQuotedString(Y),H=e.validate(d),d.baseId=M,e.util.varOccurences(H,y)<2){H=e.util.varReplace(H,y,z);var ee=z}else ee=y,n+=" var "+y+" = "+z+"; ";if(X)n+=" "+H+" ";else{if(O&&O[Y]){n+=" if ( "+ee+" === undefined ",L&&(n+=" || ! Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(Y)+"') "),n+=") { "+p+" = false; ",k=e.errorPath,B=c;var te,re=e.util.escapeQuotes(Y);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(k,Y,e.opts.jsonPointers)),c=e.errSchemaPath+"/required",(te=te||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+re+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+re+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",U=n,n=te.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+U+"]); ":n+=" validate.errors = ["+U+"]; return false; ":n+=" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=B,e.errorPath=k,n+=" } else { "}else u?(n+=" if ( "+ee+" === undefined ",L&&(n+=" || ! Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(Y)+"') "),n+=") { "+p+" = true; } else { "):(n+=" if ("+ee+" !== undefined ",L&&(n+=" &&   Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(Y)+"') "),n+=" ) { ");n+=" "+H+" } "}}u&&(n+=" if ("+p+") { ",f+="}")}}if(w.length){var ne=w;if(ne)for(var ie,ae=-1,se=ne.length-1;ae<se;)G=S[ie=ne[ae+=1]],e.util.schemaHasRules(G,e.RULES.all)&&(d.schema=G,d.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ie),d.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ie),n+=L?" "+P+" = "+P+" || Object.keys("+l+"); for (var "+v+"=0; "+v+"<"+P+".length; "+v+"++) { var "+m+" = "+P+"["+v+"]; ":" for (var "+m+" in "+l+") { ",n+=" if ("+e.usePattern(ie)+".test("+m+")) { ",d.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers),z=l+"["+m+"]",d.dataPathArr[g]=m,H=e.validate(d),d.baseId=M,e.util.varOccurences(H,y)<2?n+=" "+e.util.varReplace(H,y,z)+" ":n+=" var "+y+" = "+z+"; "+H+" ",u&&(n+=" if (!"+p+") break; "),n+=" } ",u&&(n+=" else "+p+" = true; "),n+=" }  ",u&&(n+=" if ("+p+") { ",f+="}"))}return u&&(n+=" "+f+" if ("+h+" == errors) {"),e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],c=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&o&&o.$data;d?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",n="schema"+a):n=o;var f=d?"(new RegExp("+n+"))":e.usePattern(o);i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'string') || "),i+=" !"+f+".test("+h+") ) {   ";var p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { pattern:  ",i+=d?""+n:""+e.util.toQuotedString(o),i+="  } ",!1!==e.opts.messages&&(i+=" , message: 'should match pattern \"",i+=d?"' + "+n+" + '":""+e.util.escapeQuotes(o),i+="\"' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+c:""+e.util.toQuotedString(o),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var m=i;return i=p.pop(),!e.compositeRule&&l?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",l&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="valid"+i,d="errs__"+i,f=e.util.copy(e),p="";f.level++;var m="valid"+f.level,v=f.baseId,g="prevValid"+i,y="passingSchemas"+i;n+="var "+d+" = errors , "+g+" = false , "+h+" = false , "+y+" = null; ";var P=e.compositeRule;e.compositeRule=f.compositeRule=!0;var _=s;if(_)for(var S,w=-1,E=_.length-1;w<E;)S=_[w+=1],e.util.schemaHasRules(S,e.RULES.all)?(f.schema=S,f.schemaPath=o+"["+w+"]",f.errSchemaPath=c+"/"+w,n+="  "+e.validate(f)+" ",f.baseId=v):n+=" var "+m+" = true; ",w&&(n+=" if ("+m+" && "+g+") { "+h+" = false; "+y+" = ["+y+", "+w+"]; } else { ",p+="}"),n+=" if ("+m+") { "+h+" = "+g+" = true; "+y+" = "+w+"; }";return e.compositeRule=f.compositeRule=P,n+=p+"if (!"+h+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { passingSchemas: "+y+" } ",!1!==e.opts.messages&&(n+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),n+="} else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }",e.opts.allErrors&&(n+=" } "),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="errs__"+i,d=e.util.copy(e);d.level++;var f="valid"+d.level;if(e.util.schemaHasRules(s,e.RULES.all)){d.schema=s,d.schemaPath=o,d.errSchemaPath=c,n+=" var "+h+" = errors;  ";var p,m=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.createErrors=!1,d.opts.allErrors&&(p=d.opts.allErrors,d.opts.allErrors=!1),n+=" "+e.validate(d)+" ",d.createErrors=!0,p&&(d.opts.allErrors=p),e.compositeRule=d.compositeRule=m,n+=" if ("+f+") {   ";var v=v||[];v.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var g=n;n=v.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+g+"]); ":n+=" validate.errors = ["+g+"]; return false; ":n+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } ")}else n+="  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(n+=" if (false) { ");return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],c=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&o&&o.$data;d?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",n="schema"+a):n=o,i+="var division"+a+";if (",d&&(i+=" "+n+" !== undefined && ( typeof "+n+" != 'number' || "),i+=" (division"+a+" = "+h+" / "+n+", ",e.opts.multipleOfPrecision?i+=" Math.abs(Math.round(division"+a+") - division"+a+") > 1e-"+e.opts.multipleOfPrecision+" ":i+=" division"+a+" !== parseInt(division"+a+") ",i+=" ) ",d&&(i+="  )  "),i+=" ) {   ";var f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { multipleOf: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be multiple of ",i+=d?"' + "+n:n+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+c:""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var p=i;return i=f.pop(),!e.compositeRule&&l?e.async?i+=" throw new ValidationError(["+p+"]); ":i+=" validate.errors = ["+p+"]; return false; ":i+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",l&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="valid"+i,d="errs__"+i,f=e.util.copy(e),p="";f.level++;var m="valid"+f.level,v="i"+i,g=f.dataLevel=e.dataLevel+1,y="data"+g,P=e.baseId;if(n+="var "+d+" = errors;var "+h+";",Array.isArray(s)){var _=e.schema.additionalItems;if(!1===_){n+=" "+h+" = "+l+".length <= "+s.length+"; ";var S=c;c=e.errSchemaPath+"/additionalItems",n+="  if (!"+h+") {   ";var w=w||[];w.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+s.length+" } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have more than "+s.length+" items' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var E=n;n=w.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+E+"]); ":n+=" validate.errors = ["+E+"]; return false; ":n+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",c=S,u&&(p+="}",n+=" else { ")}var b=s;if(b)for(var x,I=-1,C=b.length-1;I<C;)if(x=b[I+=1],e.util.schemaHasRules(x,e.RULES.all)){n+=" "+m+" = true; if ("+l+".length > "+I+") { ";var D=l+"["+I+"]";f.schema=x,f.schemaPath=o+"["+I+"]",f.errSchemaPath=c+"/"+I,f.errorPath=e.util.getPathExpr(e.errorPath,I,e.opts.jsonPointers,!0),f.dataPathArr[g]=I;var L=e.validate(f);f.baseId=P,e.util.varOccurences(L,y)<2?n+=" "+e.util.varReplace(L,y,D)+" ":n+=" var "+y+" = "+D+"; "+L+" ",n+=" }  ",u&&(n+=" if ("+m+") { ",p+="}")}"object"==typeof _&&e.util.schemaHasRules(_,e.RULES.all)&&(f.schema=_,f.schemaPath=e.schemaPath+".additionalItems",f.errSchemaPath=e.errSchemaPath+"/additionalItems",n+=" "+m+" = true; if ("+l+".length > "+s.length+") {  for (var "+v+" = "+s.length+"; "+v+" < "+l+".length; "+v+"++) { ",f.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0),D=l+"["+v+"]",f.dataPathArr[g]=v,L=e.validate(f),f.baseId=P,e.util.varOccurences(L,y)<2?n+=" "+e.util.varReplace(L,y,D)+" ":n+=" var "+y+" = "+D+"; "+L+" ",u&&(n+=" if (!"+m+") break; "),n+=" } }  ",u&&(n+=" if ("+m+") { ",p+="}"))}else e.util.schemaHasRules(s,e.RULES.all)&&(f.schema=s,f.schemaPath=o,f.errSchemaPath=c,n+="  for (var "+v+" = 0; "+v+" < "+l+".length; "+v+"++) { ",f.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0),D=l+"["+v+"]",f.dataPathArr[g]=v,L=e.validate(f),f.baseId=P,e.util.varOccurences(L,y)<2?n+=" "+e.util.varReplace(L,y,D)+" ":n+=" var "+y+" = "+D+"; "+L+" ",u&&(n+=" if (!"+m+") break; "),n+=" }");return u&&(n+=" "+p+" if ("+d+" == errors) {"),e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="valid"+i,d="errs__"+i,f=e.util.copy(e);f.level++;var p="valid"+f.level,m=e.schema.then,v=e.schema.else,g=void 0!==m&&e.util.schemaHasRules(m,e.RULES.all),y=void 0!==v&&e.util.schemaHasRules(v,e.RULES.all),P=f.baseId;if(g||y){var _;f.createErrors=!1,f.schema=s,f.schemaPath=o,f.errSchemaPath=c,n+=" var "+d+" = errors; var "+h+" = true;  ";var S=e.compositeRule;e.compositeRule=f.compositeRule=!0,n+="  "+e.validate(f)+" ",f.baseId=P,f.createErrors=!0,n+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }  ",e.compositeRule=f.compositeRule=S,g?(n+=" if ("+p+") {  ",f.schema=e.schema.then,f.schemaPath=e.schemaPath+".then",f.errSchemaPath=e.errSchemaPath+"/then",n+="  "+e.validate(f)+" ",f.baseId=P,n+=" "+h+" = "+p+"; ",g&&y?n+=" var "+(_="ifClause"+i)+" = 'then'; ":_="'then'",n+=" } ",y&&(n+=" else { ")):n+=" if (!"+p+") { ",y&&(f.schema=e.schema.else,f.schemaPath=e.schemaPath+".else",f.errSchemaPath=e.errSchemaPath+"/else",n+="  "+e.validate(f)+" ",f.baseId=P,n+=" "+h+" = "+p+"; ",g&&y?n+=" var "+(_="ifClause"+i)+" = 'else'; ":_="'else'",n+=" } "),n+=" if (!"+h+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { failingKeyword: "+_+" } ",!1!==e.opts.messages&&(n+=" , message: 'should match \"' + "+_+" + '\" schema' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),n+=" }   ",u&&(n+=" else { "),n=e.util.cleanUpCode(n)}else u&&(n+=" if (true) { ");return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||"");if(!1===e.opts.format)return u&&(n+=" if (true) { "),n;var h,d=e.opts.$data&&s&&s.$data;d?(n+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",h="schema"+i):h=s;var f=e.opts.unknownFormats,p=Array.isArray(f);if(d)n+=" var "+(m="format"+i)+" = formats["+h+"]; var "+(v="isObject"+i)+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+(g="formatType"+i)+" = "+v+" && "+m+".type || 'string'; if ("+v+") { ",e.async&&(n+=" var async"+i+" = "+m+".async; "),n+=" "+m+" = "+m+".validate; } if (  ",d&&(n+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),n+=" (","ignore"!=f&&(n+=" ("+h+" && !"+m+" ",p&&(n+=" && self._opts.unknownFormats.indexOf("+h+") == -1 "),n+=") || "),n+=" ("+m+" && "+g+" == '"+r+"' && !(typeof "+m+" == 'function' ? ",e.async?n+=" (async"+i+" ? await "+m+"("+l+") : "+m+"("+l+")) ":n+=" "+m+"("+l+") ",n+=" : "+m+".test("+l+"))))) {";else{var m;if(!(m=e.formats[s])){if("ignore"==f)return e.logger.warn('unknown format "'+s+'" ignored in schema at path "'+e.errSchemaPath+'"'),u&&(n+=" if (true) { "),n;if(p&&f.indexOf(s)>=0)return u&&(n+=" if (true) { "),n;throw new Error('unknown format "'+s+'" is used in schema at path "'+e.errSchemaPath+'"')}var v,g=(v="object"==typeof m&&!(m instanceof RegExp)&&m.validate)&&m.type||"string";if(v){var y=!0===m.async;m=m.validate}if(g!=r)return u&&(n+=" if (true) { "),n;if(y){if(!e.async)throw new Error("async format in sync schema");n+=" if (!(await "+(P="formats"+e.util.getProperty(s)+".validate")+"("+l+"))) { "}else{n+=" if (! ";var P="formats"+e.util.getProperty(s);v&&(P+=".validate"),n+="function"==typeof m?" "+P+"("+l+") ":" "+P+".test("+l+") ",n+=") { "}}var _=_||[];_.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { format:  ",n+=d?""+h:""+e.util.toQuotedString(s),n+="  } ",!1!==e.opts.messages&&(n+=" , message: 'should match format \"",n+=d?"' + "+h+" + '":""+e.util.escapeQuotes(s),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+o:""+e.util.toQuotedString(s),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var S=n;return n=_.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+S+"]); ":n+=" validate.errors = ["+S+"]; return false; ":n+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",u&&(n+=" else { "),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="valid"+i,d=e.opts.$data&&s&&s.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ");var f="i"+i,p="schema"+i;d||(n+=" var "+p+" = validate.schema"+o+";"),n+="var "+h+";",d&&(n+=" if (schema"+i+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+i+")) "+h+" = false; else {"),n+=h+" = false;for (var "+f+"=0; "+f+"<"+p+".length; "+f+"++) if (equal("+l+", "+p+"["+f+"])) { "+h+" = true; break; }",d&&(n+="  }  "),n+=" if (!"+h+") {   ";var m=m||[];m.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValues: schema"+i+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var v=n;return n=m.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+v+"]); ":n+=" validate.errors = ["+v+"]; return false; ":n+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",u&&(n+=" else { "),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="errs__"+i,d=e.util.copy(e),f="";d.level++;var p="valid"+d.level,m={},v={},g=e.opts.ownProperties;for(S in s){var y=s[S],P=Array.isArray(y)?v:m;P[S]=y}n+="var "+h+" = errors;";var _=e.errorPath;n+="var missing"+i+";";for(var S in v)if((P=v[S]).length){if(n+=" if ( "+l+e.util.getProperty(S)+" !== undefined ",g&&(n+=" && Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(S)+"') "),u){n+=" && ( ";var w=P;if(w)for(var E=-1,b=w.length-1;E<b;)M=w[E+=1],E&&(n+=" || "),n+=" ( ( "+(T=l+(A=e.util.getProperty(M)))+" === undefined ",g&&(n+=" || ! Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(M)+"') "),n+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?M:A)+") ) ";n+=")) {  ";var x="missing"+i,I="' + "+x+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(_,x,!0):_+" + "+x);var C=C||[];C.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(S)+"', missingProperty: '"+I+"', depsCount: "+P.length+", deps: '"+e.util.escapeQuotes(1==P.length?P[0]:P.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",1==P.length?n+="property "+e.util.escapeQuotes(P[0]):n+="properties "+e.util.escapeQuotes(P.join(", ")),n+=" when property "+e.util.escapeQuotes(S)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var D=n;n=C.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+D+"]); ":n+=" validate.errors = ["+D+"]; return false; ":n+=" var err = "+D+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{n+=" ) { ";var L=P;if(L)for(var M,R=-1,O=L.length-1;R<O;){M=L[R+=1];var A=e.util.getProperty(M),T=(I=e.util.escapeQuotes(M),l+A);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(_,M,e.opts.jsonPointers)),n+=" if ( "+T+" === undefined ",g&&(n+=" || ! Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(M)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(S)+"', missingProperty: '"+I+"', depsCount: "+P.length+", deps: '"+e.util.escapeQuotes(1==P.length?P[0]:P.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",1==P.length?n+="property "+e.util.escapeQuotes(P[0]):n+="properties "+e.util.escapeQuotes(P.join(", ")),n+=" when property "+e.util.escapeQuotes(S)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}n+=" }   ",u&&(f+="}",n+=" else { ")}e.errorPath=_;var $=d.baseId;for(var S in m)y=m[S],e.util.schemaHasRules(y,e.RULES.all)&&(n+=" "+p+" = true; if ( "+l+e.util.getProperty(S)+" !== undefined ",g&&(n+=" && Object.prototype.hasOwnProperty.call("+l+", '"+e.util.escapeQuotes(S)+"') "),n+=") { ",d.schema=y,d.schemaPath=o+e.util.getProperty(S),d.errSchemaPath=c+"/"+e.util.escapeFragment(S),n+="  "+e.validate(d)+" ",d.baseId=$,n+=" }  ",u&&(n+=" if ("+p+") { ",f+="}"));return u&&(n+="   "+f+" if ("+h+" == errors) {"),e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="valid"+i,d="errs__"+i,f=e.util.copy(e);f.level++;var p="valid"+f.level,m="i"+i,v=f.dataLevel=e.dataLevel+1,g="data"+v,y=e.baseId,P=e.util.schemaHasRules(s,e.RULES.all);if(n+="var "+d+" = errors;var "+h+";",P){var _=e.compositeRule;e.compositeRule=f.compositeRule=!0,f.schema=s,f.schemaPath=o,f.errSchemaPath=c,n+=" var "+p+" = false; for (var "+m+" = 0; "+m+" < "+l+".length; "+m+"++) { ",f.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers,!0);var S=l+"["+m+"]";f.dataPathArr[v]=m;var w=e.validate(f);f.baseId=y,e.util.varOccurences(w,g)<2?n+=" "+e.util.varReplace(w,g,S)+" ":n+=" var "+g+" = "+S+"; "+w+" ",n+=" if ("+p+") break; }  ",e.compositeRule=f.compositeRule=_,n+="  if (!"+p+") {"}else n+=" if ("+l+".length == 0) {";var E=E||[];E.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should contain a valid item' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var b=n;return n=E.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+b+"]); ":n+=" validate.errors = ["+b+"]; return false; ":n+=" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ",P&&(n+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } "),e.opts.allErrors&&(n+=" } "),e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="valid"+i,d=e.opts.$data&&s&&s.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; "),d||(n+=" var schema"+i+" = validate.schema"+o+";"),n+="var "+h+" = equal("+l+", schema"+i+"); if (!"+h+") {   ";var f=f||[];f.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValue: schema"+i+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to constant' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var p=n;return n=f.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+p+"]); ":n+=" validate.errors = ["+p+"]; return false; ":n+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",u&&(n+=" else { "),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.schema[t],a=e.errSchemaPath+"/"+t,s=(e.opts.allErrors,e.util.toQuotedString(i));return!0===e.opts.$comment?n+=" console.log("+s+");":"function"==typeof e.opts.$comment&&(n+=" self._opts.$comment("+s+", "+e.util.toQuotedString(a)+", validate.root.schema);"),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,a=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,l="data"+(a||""),h="valid"+i,d="errs__"+i,f=e.util.copy(e),p="";f.level++;var m="valid"+f.level;if(s.every(function(t){return e.util.schemaHasRules(t,e.RULES.all)})){var v=f.baseId;n+=" var "+d+" = errors; var "+h+" = false;  ";var g=e.compositeRule;e.compositeRule=f.compositeRule=!0;var y=s;if(y)for(var P,_=-1,S=y.length-1;_<S;)P=y[_+=1],f.schema=P,f.schemaPath=o+"["+_+"]",f.errSchemaPath=c+"/"+_,n+="  "+e.validate(f)+" ",f.baseId=v,n+=" "+h+" = "+h+" || "+m+"; if (!"+h+") { ",p+="}";e.compositeRule=f.compositeRule=g,n+=" "+p+" if (!"+h+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),n+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}else u&&(n+=" if (true) { ");return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.schema[t],a=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,o=!e.opts.allErrors,c=e.util.copy(e),u="";c.level++;var l="valid"+c.level,h=c.baseId,d=!0,f=i;if(f)for(var p,m=-1,v=f.length-1;m<v;)p=f[m+=1],e.util.schemaHasRules(p,e.RULES.all)&&(d=!1,c.schema=p,c.schemaPath=a+"["+m+"]",c.errSchemaPath=s+"/"+m,n+="  "+e.validate(c)+" ",c.baseId=h,o&&(n+=" if ("+l+") { ",u+="}"));return o&&(n+=d?" if (true) { ":" "+u.slice(0,-1)+" "),e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i,a=" ",s=e.level,o=e.dataLevel,c=e.schema[t],u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,h="data"+(o||""),d="valid"+s;if("#"==c||"#/"==c)e.isRoot?(n=e.async,i="validate"):(n=!0===e.root.schema.$async,i="root.refVal[0]");else{var f=e.resolveRef(e.baseId,c,e.isRoot);if(void 0===f){var p=e.MissingRefError.message(e.baseId,c);if("fail"==e.opts.missingRefs){e.logger.error(p),(y=y||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { ref: '"+e.util.escapeQuotes(c)+"' } ",!1!==e.opts.messages&&(a+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(c)+"' "),e.opts.verbose&&(a+=" , schema: "+e.util.toQuotedString(c)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),a+=" } "):a+=" {} ";var m=a;a=y.pop(),!e.compositeRule&&l?e.async?a+=" throw new ValidationError(["+m+"]); ":a+=" validate.errors = ["+m+"]; return false; ":a+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(a+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,c,p);e.logger.warn(p),l&&(a+=" if (true) { ")}}else if(f.inline){var v=e.util.copy(e);v.level++;var g="valid"+v.level;v.schema=f.schema,v.schemaPath="",v.errSchemaPath=c,a+=" "+e.validate(v).replace(/validate\.schema/g,f.code)+" ",l&&(a+=" if ("+g+") { ")}else n=!0===f.$async||e.async&&!1!==f.$async,i=f.code}if(i){var y;(y=y||[]).push(a),a="",e.opts.passContext?a+=" "+i+".call(this, ":a+=" "+i+"( ",a+=" "+h+", (dataPath || '')",'""'!=e.errorPath&&(a+=" + "+e.errorPath);var P=a+=" , "+(o?"data"+(o-1||""):"parentData")+" , "+(o?e.dataPathArr[o]:"parentDataProperty")+", rootData)  ";if(a=y.pop(),n){if(!e.async)throw new Error("async schema referenced by sync schema");l&&(a+=" var "+d+"; "),a+=" try { await "+P+"; ",l&&(a+=" "+d+" = true; "),a+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",l&&(a+=" "+d+" = false; "),a+=" } ",l&&(a+=" if ("+d+") { ")}else a+=" if (!"+P+") { if (vErrors === null) vErrors = "+i+".errors; else vErrors = vErrors.concat("+i+".errors); errors = vErrors.length; } ",l&&(a+=" else { ")}return a}},function(e,t,r){"use strict";e.exports={$ref:r(71),allOf:r(70),anyOf:r(69),$comment:r(68),const:r(67),contains:r(66),dependencies:r(65),enum:r(64),format:r(63),if:r(62),items:r(61),maximum:r(21),minimum:r(21),maxItems:r(20),minItems:r(20),maxLength:r(19),minLength:r(19),maxProperties:r(18),minProperties:r(18),multipleOf:r(60),not:r(59),oneOf:r(58),pattern:r(57),properties:r(56),propertyNames:r(55),required:r(54),uniqueItems:r(53),validate:r(22)}},function(e,t,r){"use strict";var n=r(72),i=r(5).toHash;e.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"];return e.all=i(t),e.types=i(["number","integer","string","array","object","boolean","null"]),e.forEach(function(r){r.rules=r.rules.map(function(r){var i;if("object"==typeof r){var a=Object.keys(r)[0];i=r[a],r=a,i.forEach(function(r){t.push(r),e.all[r]=!0})}return t.push(r),e.all[r]={keyword:r,code:n[r],implements:i}}),e.all.$comment={keyword:"$comment",code:n.$comment},r.type&&(e.types[r.type]=r)}),e.keywords=i(t.concat(["$schema","$id","id","$data","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),e.custom={},e}},function(e,t,r){"use strict";var n=r(5),i=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,a=[0,31,28,31,30,31,30,31,31,30,31,30,31],s=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,o=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,c=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,u=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,l=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,h=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,d=/^(?:\/(?:[^~/]|~0|~1)*)*$/,f=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,p=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;function m(e){return e="full"==e?"full":"fast",n.copy(m[e])}function v(e){var t=e.match(i);if(!t)return!1;var r,n=+t[1],s=+t[2],o=+t[3];return s>=1&&s<=12&&o>=1&&o<=(2!=s||((r=n)%4!=0||r%100==0&&r%400!=0)?a[s]:29)}function g(e,t){var r=e.match(s);if(!r)return!1;var n=r[1],i=r[2],a=r[3],o=r[5];return(n<=23&&i<=59&&a<=59||23==n&&59==i&&60==a)&&(!t||o)}e.exports=m,m.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,uri:/^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":u,url:l,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:o,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:S,uuid:h,"json-pointer":d,"json-pointer-uri-fragment":f,"relative-json-pointer":p},m.full={date:v,time:g,"date-time":function(e){var t=e.split(y);return 2==t.length&&v(t[0])&&g(t[1],!0)},uri:function(e){return P.test(e)&&c.test(e)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":u,url:l,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&''*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:function(e){return e.length<=255&&o.test(e)},ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:S,uuid:h,"json-pointer":d,"json-pointer-uri-fragment":f,"relative-json-pointer":p};var y=/t|\s/i,P=/\/|:/,_=/[^\\]\\Z/;function S(e){if(_.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}},function(e,t,r){"use strict";var n=e.exports=function(){this._cache={}};n.prototype.put=function(e,t){this._cache[e]=t},n.prototype.get=function(e){return this._cache[e]},n.prototype.del=function(e){delete this._cache[e]},n.prototype.clear=function(){this._cache={}}},function(e,t,r){"use strict";var n=e.exports=function(e,t,r){"function"==typeof t&&(r=t,t={}),function e(t,r,i,a,s,o,c,u,l){if(i&&"object"==typeof i&&!Array.isArray(i)){r(i,a,s,o,c,u,l);for(var h in i){var d=i[h];if(Array.isArray(d)){if(h in n.arrayKeywords)for(var f=0;f<d.length;f++)e(t,r,d[f],a+"/"+h+"/"+f,s,a,h,i,f)}else if(h in n.propsKeywords){if(d&&"object"==typeof d)for(var p in d)e(t,r,d[p],a+"/"+h+"/"+(m=p,m.replace(/~/g,"~0").replace(/\//g,"~1")),s,a,h,i,p)}else(h in n.keywords||t.allKeys&&!(h in n.skipKeywords))&&e(t,r,d,a+"/"+h,s,a,h,i)}}var m}(t,r,e,"",e)};n.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},n.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},n.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},n.skipKeywords={enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},function(e,t,r){"use strict";e.exports=function(e){for(var t,r=0,n=e.length,i=0;i<n;)r++,(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<n&&56320==(64512&(t=e.charCodeAt(i)))&&i++;return r}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";var n=r(10),i=r(5),a=r(8),s=r(23),o=r(22),c=i.ucs2length,u=r(9),l=a.Validation;function h(e,t,r){for(var n=0;n<this._compilations.length;n++){var i=this._compilations[n];if(i.schema==e&&i.root==t&&i.baseId==r)return n}return-1}function d(e,t){return"var pattern"+e+" = new RegExp("+i.toQuotedString(t[e])+");"}function f(e){return"var default"+e+" = defaults["+e+"];"}function p(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function m(e){return"var customRule"+e+" = customRules["+e+"];"}function v(e,t){if(!e.length)return"";for(var r="",n=0;n<e.length;n++)r+=t(n,e);return r}e.exports=function e(t,r,g,y){var P=this,_=this._opts,S=[void 0],w={},E=[],b={},x=[],I={},C=[],D=function(e,t,r){var n=h.call(this,e,t,r);return n>=0?{index:n,compiling:!0}:(n=this._compilations.length,this._compilations[n]={schema:e,root:t,baseId:r},{index:n,compiling:!1})}.call(this,t,r=r||{schema:t,refVal:S,refs:w},y),L=this._compilations[D.index];if(D.compiling)return L.callValidate=function e(){var t=L.validate,r=t.apply(null,arguments);return e.errors=t.errors,r};var M=this._formats,R=this.RULES;try{var O=T(t,r,g,y);L.validate=O;var A=L.callValidate;return A&&(A.schema=O.schema,A.errors=null,A.refs=O.refs,A.refVal=O.refVal,A.root=O.root,A.$async=O.$async,_.sourceCode&&(A.source=O.source)),O}finally{(function(e,t,r){var n=h.call(this,e,t,r);n>=0&&this._compilations.splice(n,1)}).call(this,t,r,y)}function T(t,s,h,g){var y=!s||s&&s.schema==t;if(s.schema!=r.schema)return e.call(P,t,s,h,g);var b,I=!0===t.$async,D=o({isTop:!0,schema:t,isRoot:y,baseId:g,root:s,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:a.MissingRef,RULES:R,validate:o,util:i,resolve:n,resolveRef:$,usePattern:V,useDefault:k,useCustomRule:N,opts:_,formats:M,logger:P.logger,self:P});D=v(S,p)+v(E,d)+v(x,f)+v(C,m)+D,_.processCode&&(D=_.processCode(D));try{b=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",D)(P,R,M,r,S,x,C,u,c,l),S[0]=b}catch(t){throw P.logger.error("Error compiling schema, function code:",D),t}return b.schema=t,b.errors=null,b.refs=w,b.refVal=S,b.root=y?b:s,I&&(b.$async=!0),!0===_.sourceCode&&(b.source={code:D,patterns:E,defaults:x}),b}function $(t,i,a){i=n.url(t,i);var s,o,c=w[i];if(void 0!==c)return j(s=S[c],o="refVal["+c+"]");if(!a&&r.refs){var u=r.refs[i];if(void 0!==u)return s=r.refVal[u],o=F(i,s),j(s,o)}o=F(i);var l,h,d,f=n.call(P,T,r,i);if(void 0===f){var p=g&&g[i];p&&(f=n.inlineRef(p,_.inlineRefs)?p:e.call(P,p,r,g,t))}if(void 0!==f)return l=i,h=f,d=w[l],S[d]=h,j(f,o);delete w[i]}function F(e,t){var r=S.length;return S[r]=t,w[e]=r,"refVal"+r}function j(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&!!e.$async}}function V(e){var t=b[e];return void 0===t&&(t=b[e]=E.length,E[t]=e),"pattern"+t}function k(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return i.toQuotedString(e);case"object":if(null===e)return"null";var t=s(e),r=I[t];return void 0===r&&(r=I[t]=x.length,x[r]=e),"default"+r}}function N(e,t,r,n){var i=e.definition.validateSchema;if(i&&!1!==P._opts.validateSchema&&!i(t)){var a="keyword schema is invalid: "+P.errorsText(i.errors);if("log"!=P._opts.validateSchema)throw new Error(a);P.logger.error(a)}var s,o=e.definition.compile,c=e.definition.inline,u=e.definition.macro;if(o)s=o.call(P,t,r,n);else if(u)s=u.call(P,t,r,n),!1!==_.validateSchema&&P.validateSchema(s,!0);else if(c)s=c.call(P,n,e.keyword,t,r);else if(!(s=e.definition.validate))return;if(void 0===s)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var l=C.length;return C[l]=s,{code:"customRule"+l,validate:s}}}},function(e,t,r){"use strict";var n=r(79),i=r(10),a=r(75),s=r(24),o=r(23),c=r(74),u=r(73),l=r(52),h=r(5);e.exports=g,g.prototype.validate=function(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var n=this._addSchema(e);r=n.validate||this._compile(n)}var i=r(t);return!0!==r.$async&&(this.errors=r.errors),i},g.prototype.compile=function(e,t){var r=this._addSchema(e,void 0,t);return r.validate||this._compile(r)},g.prototype.addSchema=function(e,t,r,n){if(Array.isArray(e)){for(var a=0;a<e.length;a++)this.addSchema(e[a],void 0,r,n);return this}var s=this._getId(e);if(void 0!==s&&"string"!=typeof s)throw new Error("schema id must be string");return E(this,t=i.normalizeId(t||s)),this._schemas[t]=this._addSchema(e,r,n,!0),this},g.prototype.addMetaSchema=function(e,t,r){return this.addSchema(e,t,r,!0),this},g.prototype.validateSchema=function(e,t){var r,n,i=e.$schema;if(void 0!==i&&"string"!=typeof i)throw new Error("$schema must be a string");if(!(i=i||this._opts.defaultMeta||(r=this,n=r._opts.meta,r._opts.defaultMeta="object"==typeof n?r._getId(n)||n:r.getSchema(p)?p:void 0,r._opts.defaultMeta)))return this.logger.warn("meta-schema not available"),this.errors=null,!0;var a,s=this._formats.uri;this._formats.uri="function"==typeof s?this._schemaUriFormatFunc:this._schemaUriFormat;try{a=this.validate(i,e)}finally{this._formats.uri=s}if(!a&&t){var o="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(o);this.logger.error(o)}return a},g.prototype.getSchema=function(e){var t=y(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return function(e,t){var r=i.schema.call(e,{schema:{}},t);if(r){var a=r.schema,o=r.root,c=r.baseId,u=n.call(e,a,o,void 0,c);return e._fragments[t]=new s({ref:t,fragment:!0,schema:a,root:o,baseId:c,validate:u}),u}}(this,e)}},g.prototype.removeSchema=function(e){if(e instanceof RegExp)return P(this,this._schemas,e),P(this,this._refs,e),this;switch(typeof e){case"undefined":return P(this,this._schemas),P(this,this._refs),this._cache.clear(),this;case"string":var t=y(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],delete this._refs[e],this;case"object":var r=this._opts.serialize,n=r?r(e):e;this._cache.del(n);var a=this._getId(e);a&&(a=i.normalizeId(a),delete this._schemas[a],delete this._refs[a])}return this},g.prototype.addFormat=function(e,t){return"string"==typeof t&&(t=new RegExp(t)),this._formats[e]=t,this},g.prototype.errorsText=function(e,t){if(!(e=e||this.errors))return"No errors";for(var r=void 0===(t=t||{}).separator?", ":t.separator,n=void 0===t.dataVar?"data":t.dataVar,i="",a=0;a<e.length;a++){var s=e[a];s&&(i+=n+s.dataPath+" "+s.message+r)}return i.slice(0,-r.length)},g.prototype._addSchema=function(e,t,r,n){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var a=this._opts.serialize,o=a?a(e):e,c=this._cache.get(o);if(c)return c;n=n||!1!==this._opts.addUsedSchema;var u=i.normalizeId(this._getId(e));u&&n&&E(this,u);var l,h=!1!==this._opts.validateSchema&&!t;h&&!(l=u&&u==i.normalizeId(e.$schema))&&this.validateSchema(e,!0);var d=i.ids.call(this,e),f=new s({id:u,schema:e,localRefs:d,cacheKey:o,meta:r});return"#"!=u[0]&&n&&(this._refs[u]=f),this._cache.put(o,f),h&&l&&this.validateSchema(e,!0),f},g.prototype._compile=function(e,t){if(e.compiling)return e.validate=a,a.schema=e.schema,a.errors=null,a.root=t||a,!0===e.schema.$async&&(a.$async=!0),a;var r,i;e.compiling=!0,e.meta&&(r=this._opts,this._opts=this._metaOpts);try{i=n.call(this,e.schema,t,e.localRefs)}finally{e.compiling=!1,e.meta&&(this._opts=r)}return e.validate=i,e.refs=i.refs,e.refVal=i.refVal,e.root=i.root,i;function a(){var t=e.validate,r=t.apply(null,arguments);return a.errors=t.errors,r}},g.prototype.compileAsync=r(51);var d=r(50);g.prototype.addKeyword=d.add,g.prototype.getKeyword=d.get,g.prototype.removeKeyword=d.remove;var f=r(8);g.ValidationError=f.Validation,g.MissingRefError=f.MissingRef,g.$dataMetaSchema=l;var p="http://json-schema.org/draft-07/schema",m=["removeAdditional","useDefaults","coerceTypes"],v=["/properties"];function g(e){if(!(this instanceof g))return new g(e);e=this._opts=h.copy(e)||{},function(e){var t=e._opts.logger;if(!1===t)e.logger={log:b,warn:b,error:b};else{if(void 0===t&&(t=console),!("object"==typeof t&&t.log&&t.warn&&t.error))throw new Error("logger must implement log, warn and error methods");e.logger=t}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=c(e.format);var t=this._schemaUriFormat=this._formats["uri-reference"];this._schemaUriFormatFunc=function(e){return t.test(e)},this._cache=e.cache||new a,this._loadingSchemas={},this._compilations=[],this.RULES=u(),this._getId=function(e){switch(e.schemaId){case"auto":return w;case"id":return _;default:return S}}(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=o),this._metaOpts=function(e){for(var t=h.copy(e._opts),r=0;r<m.length;r++)delete t[m[r]];return t}(this),e.formats&&function(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}(this),function(e){var t;if(e._opts.$data&&(t=r(48),e.addMetaSchema(t,t.$id,!0)),!1!==e._opts.meta){var n=r(47);e._opts.$data&&(n=l(n,v)),e.addMetaSchema(n,p,!0),e._refs["http://json-schema.org/schema"]=p}}(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),function(e){var t=e._opts.schemas;if(t)if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}(this)}function y(e,t){return t=i.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function P(e,t,r){for(var n in t){var i=t[n];i.meta||r&&!r.test(n)||(e._cache.del(i.cacheKey),delete t[n])}}function _(e){return e.$id&&this.logger.warn("schema $id ignored",e.$id),e.id}function S(e){return e.id&&this.logger.warn("schema id ignored",e.id),e.$id}function w(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function E(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function b(){}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),a=r(7);t.ButtplugBrowserWebsocketConnector=class extends i.EventEmitter{constructor(e){super(),this._url=e,this.Connect=(()=>n(this,void 0,void 0,function*(){const e=new WebSocket(this._url);let t,r;const i=new Promise((e,n)=>{t=e,r=n}),a=e=>r();return e.addEventListener("open",r=>n(this,void 0,void 0,function*(){this._ws=e,this._ws.addEventListener("message",e=>{this.ParseIncomingMessage(e)}),this._ws.removeEventListener("close",a),this._ws.addEventListener("close",this.Disconnect),t()})),e.addEventListener("close",a),i})),this.Disconnect=(()=>{this.Connected&&(this._ws.close(),this._ws=void 0,this.emit("disconnect"))}),this.Send=(e=>{if(!this.Connected)throw new Error("ButtplugClient not connected");this._ws.send("["+e.toJSON()+"]")}),this.ParseIncomingMessage=(e=>{if("string"==typeof e.data){const t=a.FromJSON(e.data);this.emit("message",t)}else if(e.data instanceof Blob){const t=new FileReader;t.addEventListener("load",e=>{this.OnReaderLoad(e)}),t.readAsText(e.data)}})}get Connected(){return void 0!==this._ws}OnReaderLoad(e){const t=a.FromJSON(e.target.result);this.emit("message",t)}}},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],l=!1,h=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!l){var e=o(d);l=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||l||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){(function(e,t){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r,n;n=r||(r={}),function(r){var i="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),a=s(n);function s(e,t){return function(r,n){"function"!=typeof e[r]&&Object.defineProperty(e,r,{configurable:!0,writable:!0,value:n}),t&&t(r,n)}}void 0===i.Reflect?i.Reflect=n:a=s(i.Reflect,a),function(t){var r=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,c=!s&&!o,u={create:s?function(){return M(Object.create(null))}:o?function(){return M({__proto__:null})}:function(){return M({})},has:c?function(e,t){return r.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return r.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),h="object"==typeof e&&Object({NODE_ENV:"production"})&&"true"===Object({NODE_ENV:"production"}).REFLECT_METADATA_USE_MAP_POLYFILL,d=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var n=this._keys.length,i=r+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,n)},t.prototype.values=function(){return new r(this._keys,this._values,i)},t.prototype.entries=function(){return new r(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function i(e,t){return t}function s(e,t){return[e,t]}}():Map,f=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}():Set,p=new(h||"function"!=typeof WeakMap?function(){var e=16,t=u.create(),n=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=a(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=a(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return a(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=a(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+o()}while(u.has(t,e));return t[e]=!0,e}function a(e,t){if(!r.call(e,n)){if(!t)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function s(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function o(){var t,r=(t=e,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t):s(new Array(t),t));r[6]=79&r[6]|64,r[8]=191&r[8]|128;for(var n="",i=0;i<e;++i){var a=r[i];4!==i&&6!==i&&8!==i||(n+="-"),a<16&&(n+="0"),n+=a.toString(16).toLowerCase()}return n}}():WeakMap);function m(e,t,r){var n=p.get(e);if(S(n)){if(!r)return;n=new d,p.set(e,n)}var i=n.get(t);if(S(i)){if(!r)return;i=new d,n.set(t,i)}return i}function v(e,t,r){var n=m(t,r,!1);return!S(n)&&!!n.has(e)}function g(e,t,r){var n=m(t,r,!1);if(!S(n))return n.get(e)}function y(e,t,r,n){m(r,n,!0).set(e,t)}function P(e,t){var r,n,i=[],s=m(e,t,!1);if(S(s))return i;for(var o,c=function(e){var t=D(e,a);if(!I(t))throw new TypeError;var r=t.call(e);if(!E(r))throw new TypeError;return r}(s.keys()),u=0;;){var l=!(o=c.next()).done&&o;if(!l)return i.length=u,i;var h=l.value;try{i[u]=h}catch(e){try{n=void 0,(n=(r=c).return)&&n.call(r)}finally{throw e}}u++}}function _(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function S(e){return void 0===e}function w(e){return null===e}function E(e){return"object"==typeof e?null!==e:"function"==typeof e}function b(e){var t=function(e,t){switch(_(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",n=D(e,i);if(void 0!==n){var a=n.call(e,r);if(E(a))throw new TypeError;return a}return function(e,t){if("string"===t){var r=e.toString;if(I(r)&&!E(i=r.call(e)))return i;if(I(n=e.valueOf)&&!E(i=n.call(e)))return i}else{var n;if(I(n=e.valueOf)&&!E(i=n.call(e)))return i;var i,a=e.toString;if(I(a)&&!E(i=a.call(e)))return i}throw new TypeError}(e,"default"===r?"number":r)}(e,3);return"symbol"==typeof t?t:""+t}function x(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function I(e){return"function"==typeof e}function C(e){return"function"==typeof e}function D(e,t){var r=e[t];if(void 0!==r&&null!==r){if(!I(r))throw new TypeError;return r}}function L(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return t;var i=n.constructor;return"function"!=typeof i?t:i===e?t:i}function M(e){return e.__=void 0,delete e.__,e}t("decorate",function(e,t,r,n){if(S(r)){if(!x(e))throw new TypeError;if(!C(t))throw new TypeError;return function(e,t){for(var r=e.length-1;r>=0;--r){var n=(0,e[r])(t);if(!S(n)&&!w(n)){if(!C(n))throw new TypeError;t=n}}return t}(e,t)}if(!x(e))throw new TypeError;if(!E(t))throw new TypeError;if(!E(n)&&!S(n)&&!w(n))throw new TypeError;return w(n)&&(n=void 0),function(e,t,r,n){for(var i=e.length-1;i>=0;--i){var a=(0,e[i])(t,r,n);if(!S(a)&&!w(a)){if(!E(a))throw new TypeError;n=a}}return n}(e,t,r=b(r),n)}),t("metadata",function(e,t){return function(r,n){if(!E(r))throw new TypeError;if(!S(n)&&!function(e){switch(_(e)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;y(e,t,r,n)}}),t("defineMetadata",function(e,t,r,n){if(!E(r))throw new TypeError;return S(n)||(n=b(n)),y(e,t,r,n)}),t("hasMetadata",function(e,t,r){if(!E(t))throw new TypeError;return S(r)||(r=b(r)),function e(t,r,n){if(v(t,r,n))return!0;var i=L(r);return!w(i)&&e(t,i,n)}(e,t,r)}),t("hasOwnMetadata",function(e,t,r){if(!E(t))throw new TypeError;return S(r)||(r=b(r)),v(e,t,r)}),t("getMetadata",function(e,t,r){if(!E(t))throw new TypeError;return S(r)||(r=b(r)),function e(t,r,n){if(v(t,r,n))return g(t,r,n);var i=L(r);return w(i)?void 0:e(t,i,n)}(e,t,r)}),t("getOwnMetadata",function(e,t,r){if(!E(t))throw new TypeError;return S(r)||(r=b(r)),g(e,t,r)}),t("getMetadataKeys",function(e,t){if(!E(e))throw new TypeError;return S(t)||(t=b(t)),function e(t,r){var n=P(t,r),i=L(t);if(null===i)return n;var a=e(i,r);if(a.length<=0)return n;if(n.length<=0)return a;for(var s=new f,o=[],c=0,u=n;c<u.length;c++){var l=u[c];s.has(l)||(s.add(l),o.push(l))}for(var h=0,d=a;h<d.length;h++){l=d[h];s.has(l)||(s.add(l),o.push(l))}return o}(e,t)}),t("getOwnMetadataKeys",function(e,t){if(!E(e))throw new TypeError;return S(t)||(t=b(t)),P(e,t)}),t("deleteMetadata",function(e,t,r){if(!E(t))throw new TypeError;S(r)||(r=b(r));var n=m(t,r,!1);if(S(n))return!1;if(!n.delete(e))return!1;if(n.size>0)return!0;var i=p.get(t);return i.delete(r),i.size>0||(p.delete(t),!0)})}(a)}()}).call(this,r(82),r(11))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,r,n){this.target=e,this.propertyName=t,this.transformFn=r,this.options=n};t.TransformMetadata=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,r){this.target=e,this.propertyName=t,this.options=r};t.ExcludeMetadata=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,r){this.target=e,this.propertyName=t,this.options=r};t.ExposeMetadata=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,r,n){this.target=e,this.propertyName=t,this.reflectedType=r,this.typeFunction=n};t.TypeMetadata=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(26),a=r(87),s=r(86),o=r(85),c=r(84);t.Transform=function(e,t){return function(r,n){var a=new c.TransformMetadata(r.constructor,n,e,t);i.defaultMetadataStorage.addTransformMetadata(a)}},t.Type=function(e){return function(t,r){var n=Reflect.getMetadata("design:type",t,r),s=new a.TypeMetadata(t.constructor,r,n,e);i.defaultMetadataStorage.addTypeMetadata(s)}},t.Expose=function(e){return function(t,r){var n=new s.ExposeMetadata(t instanceof Function?t:t.constructor,r,e||{});i.defaultMetadataStorage.addExposeMetadata(n)}},t.Exclude=function(e){return function(t,r){var n=new o.ExcludeMetadata(t instanceof Function?t:t.constructor,r,e||{});i.defaultMetadataStorage.addExcludeMetadata(n)}},t.TransformClassToPlain=function(e){return function(t,r,i){var a=new n.ClassTransformer,s=i.value;i.value=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=s.apply(this,t);return!n||"object"!=typeof n&&"function"!=typeof n||"function"!=typeof n.then?a.classToPlain(n,e):n.then(function(t){return a.classToPlain(t,e)})}}},t.TransformClassToClass=function(e){return function(t,r,i){var a=new n.ClassTransformer,s=i.value;i.value=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=s.apply(this,t);return!n||"object"!=typeof n&&"function"!=typeof n||"function"!=typeof n.then?a.classToClass(n,e):n.then(function(t){return a.classToClass(t,e)})}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(27),i=function(){function e(){this._typeMetadatas=[],this._transformMetadatas=[],this._exposeMetadatas=[],this._excludeMetadatas=[]}return e.prototype.addTypeMetadata=function(e){this._typeMetadatas.push(e)},e.prototype.addTransformMetadata=function(e){this._transformMetadatas.push(e)},e.prototype.addExposeMetadata=function(e){this._exposeMetadatas.push(e)},e.prototype.addExcludeMetadata=function(e){this._excludeMetadatas.push(e)},e.prototype.findTransformMetadatas=function(e,t,r){return this.findMetadatas(this._transformMetadatas,e,t).filter(function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?r===n.TransformationType.CLASS_TO_CLASS||r===n.TransformationType.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||r===n.TransformationType.CLASS_TO_PLAIN)})},e.prototype.findExcludeMetadata=function(e,t){return this.findMetadata(this._excludeMetadatas,e,t)},e.prototype.findExposeMetadata=function(e,t){return this.findMetadata(this._exposeMetadatas,e,t)},e.prototype.findExposeMetadataByCustomName=function(e,t){return this.getExposedMetadatas(e).find(function(e){return e.options&&e.options.name===t})},e.prototype.findTypeMetadata=function(e,t){return this.findMetadata(this._typeMetadatas,e,t)},e.prototype.getStrategy=function(e){var t=this._excludeMetadatas.find(function(t){return t.target===e&&void 0===t.propertyName}),r=this._exposeMetadatas.find(function(t){return t.target===e&&void 0===t.propertyName});return t&&r||!t&&!r?"none":t?"excludeAll":"exposeAll"},e.prototype.getExposedMetadatas=function(e){return this.getMetadata(this._exposeMetadatas,e)},e.prototype.getExcludedMetadatas=function(e){return this.getMetadata(this._excludeMetadatas,e)},e.prototype.getExposedProperties=function(e,t){return this.getExposedMetadatas(e).filter(function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?t===n.TransformationType.CLASS_TO_CLASS||t===n.TransformationType.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||t===n.TransformationType.CLASS_TO_PLAIN)}).map(function(e){return e.propertyName})},e.prototype.getExcludedProperties=function(e,t){return this.getExcludedMetadatas(e).filter(function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?t===n.TransformationType.CLASS_TO_CLASS||t===n.TransformationType.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||t===n.TransformationType.CLASS_TO_PLAIN)}).map(function(e){return e.propertyName})},e.prototype.clear=function(){this._typeMetadatas=[],this._exposeMetadatas=[],this._excludeMetadatas=[]},e.prototype.getMetadata=function(e,t){var r=e.filter(function(e){return e.target===t&&void 0!==e.propertyName});return e.filter(function(e){return t&&t.prototype instanceof e.target&&void 0!==e.propertyName}).concat(r)},e.prototype.findMetadata=function(e,t,r){var n=e.find(function(e){return e.target===t&&e.propertyName===r}),i=e.find(function(e){return t&&t.prototype instanceof e.target&&e.propertyName===r});return n||i},e.prototype.findMetadatas=function(e,t,r){var n=e.filter(function(e){return e.target===t&&e.propertyName===r});return e.filter(function(e){return t&&t.prototype instanceof e.target&&e.propertyName===r}).reverse().concat(n.reverse())},e}();t.MetadataStorage=i},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=r(6),a=r(1),s=r(25),o=r(81),c=r(17),u=r(0),l=r(7);t.ButtplugClient=class extends a.EventEmitter{constructor(e="Generic Buttplug Client"){super(),this._pingTimer=null,this._connector=null,this._devices=new Map,this._counter=1,this._waitingMsgs=new Map,this._logger=i.ButtplugLogger.Logger,this._messageVersion=1,this.ConnectWebsocket=(e=>n(this,void 0,void 0,function*(){this._logger.Info(`ButtplugClient: Connecting to ${e}`),yield this.Connect(new o.ButtplugBrowserWebsocketConnector(e))})),this.ConnectLocal=(()=>n(this,void 0,void 0,function*(){this._logger.Info("ButtplugClient: Connecting to In-Browser Server"),yield this.Connect(new c.ButtplugEmbeddedServerConnector)})),this.Connect=(e=>n(this,void 0,void 0,function*(){this._logger.Info(`ButtplugClient: Connecting using ${e.constructor.name}`),yield e.Connect(),this._connector=e,this._connector.addListener("message",this.ParseMessages),this._connector.addListener("disconnect",this.DisconnectHandler),yield this.InitializeConnection()})),this.Disconnect=(()=>n(this,void 0,void 0,function*(){this._logger.Debug("ButtplugClient: Disconnect called"),this.CheckConnector(),yield this.ShutdownConnection(),this._connector.Disconnect()})),this.StartScanning=(()=>n(this,void 0,void 0,function*(){return this._logger.Debug("ButtplugClient: StartScanning called"),yield this.SendMsgExpectOk(new u.StartScanning)})),this.StopScanning=(()=>n(this,void 0,void 0,function*(){return this._logger.Debug("ButtplugClient: StopScanning called"),yield this.SendMsgExpectOk(new u.StopScanning)})),this.RequestLog=(e=>n(this,void 0,void 0,function*(){return this._logger.Debug(`ButtplugClient: RequestLog called with level ${e}`),yield this.SendMsgExpectOk(new u.RequestLog(e))})),this.StopAllDevices=(()=>n(this,void 0,void 0,function*(){return this._logger.Debug("ButtplugClient: StopAllDevices"),yield this.SendMsgExpectOk(new u.StopAllDevices)})),this.ParseMessages=(e=>{this.ParseMessagesInternal(e)}),this.DisconnectHandler=(()=>{this._logger.Info("ButtplugClient: Disconnect event receieved."),this.emit("disconnect")}),this.InitializeConnection=(()=>n(this,void 0,void 0,function*(){this.CheckConnector();const e=yield this.SendMessage(new u.RequestServerInfo(this._clientName,1));switch(e.Type){case"ServerInfo":{const t=e;this._logger.Info(`ButtplugClient: Connected to Server ${t.ServerName}`);const r=t.MaxPingTime;if(t.MessageVersion<this._messageVersion)throw this._connector.Disconnect(),new Error("Server protocol version is older than client protocol version. Please update server.");return r>0&&(this._pingTimer=setInterval(()=>n(this,void 0,void 0,function*(){this.Connected?this.SendMessage(new u.Ping(this._counter)):yield this.ShutdownConnection()}),Math.round(r/2))),yield this.RequestDeviceList(),!0}case"Error":{const t=e;throw this._logger.Error(`ButtplugClient: Cannot connect to server. ${t.ErrorMessage}`),this._connector.Disconnect(),new Error(e.ErrorMessage)}}return!1})),this.RequestDeviceList=(()=>n(this,void 0,void 0,function*(){this.CheckConnector(),this._logger.Debug("ButtplugClient: ReceiveDeviceList called"),(yield this.SendMessage(new u.RequestDeviceList)).Devices.forEach(e=>{if(this._devices.has(e.DeviceIndex))this._logger.Debug(`ButtplugClient: Device already added: ${e}`);else{const t=s.Device.fromMsg(e);this._logger.Debug(`ButtplugClient: Adding Device: ${t}`),this._devices.set(e.DeviceIndex,t),this.emit("deviceadded",t)}})})),this.ShutdownConnection=(()=>n(this,void 0,void 0,function*(){yield this.StopAllDevices(),null!==this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null)})),this.SendMsgExpectOk=(e=>n(this,void 0,void 0,function*(){let t,r;const n=yield this.SendMessage(e),i=new Promise((e,n)=>{t=e,r=n});switch(n.Type){case"Ok":t();break;default:r(n)}return i})),this._clientName=e,this._logger.Debug(`ButtplugClient: Client ${e} created.`)}get Connector(){return this._connector}get Connected(){return null!==this._connector&&this._connector.Connected}get Devices(){this.CheckConnector();const e=[];return this._devices.forEach((t,r)=>{e.push(t)}),e}SendDeviceMessage(e,t){return n(this,void 0,void 0,function*(){this.CheckConnector();const r=this._devices.get(e.Index);return void 0===r?(this._logger.Error(`Device ${e.Index} not available.`),Promise.reject(new Error("Device not available."))):-1===r.AllowedMessages.indexOf(t.Type)?(this._logger.Error(`Device ${e.Name} does not accept message type ${t.Type}.`),Promise.reject(new Error(`Device ${e.Name} does not accept message type ${t.Type}.`))):(t.DeviceIndex=e.Index,yield this.SendMsgExpectOk(t))})}ParseMessagesInternal(e){for(const t of e){if(t.Id>0&&this._waitingMsgs.has(t.Id))return void this._waitingMsgs.get(t.Id)(t);switch(t.Type){case"Log":this.emit("log",t);break;case"DeviceAdded":const e=t,r=s.Device.fromMsg(e);this._devices.set(e.DeviceIndex,r),this.emit("deviceadded",r);break;case"DeviceRemoved":const n=t;if(this._devices.has(n.DeviceIndex)){const e=this._devices.get(n.DeviceIndex);this._devices.delete(n.DeviceIndex),this.emit("deviceremoved",e)}break;case"ScanningFinished":this.emit("scanningfinished",t)}}}SendMessage(e){return n(this,void 0,void 0,function*(){let t;this.CheckConnector(),l.CheckMessage(e),e.Id=this._counter;const r=new Promise(e=>{t=e});return this._waitingMsgs.set(this._counter,t),this._counter+=1,this._connector.Send(e),yield r})}CheckConnector(){if(!this.Connected)throw new Error("ButtplugClient not connected")}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(90)),n(r(32)),n(r(17)),n(r(0)),n(r(7)),n(r(25)),n(r(6)),n(r(16)),n(r(14)),n(r(31)),n(r(3)),n(r(4)),n(r(15)),n(r(30))}])});
//# sourceMappingURL=buttplug.min.js.map